import{a4 as $,cj as P,a3 as R,ck as re,cl as X,cm as ae,cn as J,co as oe,cp as Y,cq as de,cr as se,a5 as ue,cs as ce,_ as V,d as M,a as y,o as m,b as h,p as S,q as b,F as I,l as D,n as F,t as w,N as k,H as W,g as O,r as Q,c as E,h as fe,bf as pe,bi as me,j as C,m as T,ct as he,cu as ye,Q as q,R as z,U as K,cv as ge,cw as ve,cx as xe,W as Ie,c5 as Se,be as Fe,a9 as H,bL as we,w as be,Y as De}from"./index-DmUMvrSQ.js";function Te(e,t){for(var l=-1,n=e==null?0:e.length,i=Array(n);++l<n;)i[l]=t(e[l],l,e);return i}var G=R?R.prototype:void 0,U=G?G.toString:void 0;function Z(e){if(typeof e=="string")return e;if($(e))return Te(e,Z)+"";if(P(e))return U?U.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var $e=1/0,Ee=17976931348623157e292;function Ae(e){if(!e)return e===0?e:0;if(e=re(e),e===$e||e===-1/0){var t=e<0?-1:1;return t*Ee}return e===e?e:0}function Ne(e){var t=Ae(e),l=t%1;return t===t?l?t-l:t:0}function ke(e){return e}function Ce(e,t,l,n){for(var i=e.length,a=l+-1;++a<i;)if(t(e[a],a,e))return a;return-1}var Pe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ve=/^\w*$/;function B(e,t){if($(e))return!1;var l=typeof e;return l=="number"||l=="symbol"||l=="boolean"||e==null||P(e)?!0:Ve.test(e)||!Pe.test(e)||t!=null&&e in Object(t)}var Me="Expected a function";function L(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Me);var l=function(){var n=arguments,i=t?t.apply(this,n):n[0],a=l.cache;if(a.has(i))return a.get(i);var r=e.apply(this,n);return l.cache=a.set(i,r)||a,r};return l.cache=new(L.Cache||X),l}L.Cache=X;var Oe=500;function Be(e){var t=L(e,function(n){return l.size===Oe&&l.clear(),n}),l=t.cache;return t}var Le=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Re=/\\(\\)?/g,We=Be(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Le,function(l,n,i,a){t.push(i?a.replace(Re,"$1"):n||l)}),t});function Qe(e){return e==null?"":Z(e)}function j(e,t){return $(e)?e:B(e,t)?[e]:We(Qe(e))}function A(e){if(typeof e=="string"||P(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}function _(e,t){t=j(t,e);for(var l=0,n=t.length;e!=null&&l<n;)e=e[A(t[l++])];return l&&l==n?e:void 0}function qe(e,t,l){var n=e==null?void 0:_(e,t);return n===void 0?l:n}var ze=1,Ke=2;function He(e,t,l,n){var i=l.length,a=i;if(e==null)return!a;for(e=Object(e);i--;){var r=l[i];if(r[2]?r[1]!==e[r[0]]:!(r[0]in e))return!1}for(;++i<a;){r=l[i];var s=r[0],d=e[s],o=r[1];if(r[2]){if(d===void 0&&!(s in e))return!1}else{var u=new ae,f;if(!(f===void 0?J(o,d,ze|Ke,n,u):f))return!1}}return!0}function ee(e){return e===e&&!oe(e)}function Ge(e){for(var t=Y(e),l=t.length;l--;){var n=t[l],i=e[n];t[l]=[n,i,ee(i)]}return t}function te(e,t){return function(l){return l==null?!1:l[e]===t&&(t!==void 0||e in Object(l))}}function Ue(e){var t=Ge(e);return t.length==1&&t[0][2]?te(t[0][0],t[0][1]):function(l){return l===e||He(l,e,t)}}function Xe(e,t){return e!=null&&t in Object(e)}function Je(e,t,l){t=j(t,e);for(var n=-1,i=t.length,a=!1;++n<i;){var r=A(t[n]);if(!(a=e!=null&&l(e,r)))break;e=e[r]}return a||++n!=i?a:(i=e==null?0:e.length,!!i&&de(i)&&se(r,i)&&($(e)||ue(e)))}function Ye(e,t){return e!=null&&Je(e,t,Xe)}var Ze=1,je=2;function _e(e,t){return B(e)&&ee(t)?te(A(e),t):function(l){var n=qe(l,e);return n===void 0&&n===t?Ye(l,e):J(t,n,Ze|je)}}function et(e){return function(t){return t==null?void 0:t[e]}}function tt(e){return function(t){return _(t,e)}}function lt(e){return B(e)?et(A(e)):tt(e)}function le(e){return typeof e=="function"?e:e==null?ke:typeof e=="object"?$(e)?_e(e[0],e[1]):Ue(e):lt(e)}function nt(e){return function(t,l,n){var i=Object(t);if(!ce(t)){var a=le(l);t=Y(t),l=function(s){return a(i[s],s,i)}}var r=e(t,l,n);return r>-1?i[a?t[r]:r]:void 0}}var it=Math.max;function rt(e,t,l){var n=e==null?0:e.length;if(!n)return-1;var i=l==null?0:Ne(l);return i<0&&(i=it(n+i,0)),Ce(e,le(t),i)}var at=nt(rt);const ot=M({name:"MsComboboxTreeDropdown",props:{isMulti:{type:Boolean,default:!1},maxItemsDisplay:{type:Number,default:10},columns:{type:Array,default(){return[]}},loading:{type:Boolean,default:!1},dropdownWidth:{type:[Number,String],default:0},showEmptyText:{type:Boolean,default:!1},topx:{type:Number,default:null},leftx:{type:Number,default:null},maxWidthx:{type:Number,default:null},minWidthx:{type:Number,default:null},highlighIndex:{type:Number,default:null},scrollTop:{type:Number,default:0}},setup(e,{emit:t}){let l=0;const{proxy:n}=O();let i=Q(),a=Q();const r=p=>({width:p.isResize?null:`${p.width}px`,textAlign:p.columnAlign}),s=p=>{let g=p.target.closest(".ms-combo"),v=n.$parent.$el;g!==v&&n.$parent.collapse()},d=p=>{let g=p.target;g.scrollTop>=g.scrollHeight-g.offsetHeight&&t("scrollend"),n._scrollTop=g.scrollTop},o=p=>{const g=p.target.closest(".combo-dropdown-panel");if(!g||g!==n.$el){if(p.target&&n.$parent&&n.$parent.$refs.input&&p.target===n.$parent.$refs.input)return;if(n.$parent&&n.$parent.$options&&n.$parent.$options.name=="MsComboboxTreeMultiSelect")return;n.$parent.collapse()}},u=()=>{n.$parent.collapse()},f=()=>{t("addNew")},c=E(()=>({})),x=E(()=>{let p=0;if(l)p=l;else if(e.columns&&e.columns.length>0)for(let g=0;g<e.columns.length;g++){const v=e.columns[g];v.width&&(p=p+v.width)}return p}),ne=E(()=>{let p=x,g=document.body.clientWidth,v=e.leftx;v+p+e.dropdownWidth>g&&(v=v-(p+v+e.dropdownWidth-g));let N={top:e.topx+"px",minWidth:e.minWidthx+"px",maxWidth:e.maxWidthx+"px"};return v+p>=g?N.right="10px":N.left=v+"px",N}),ie=E(()=>{let p={};return e.maxItemsDisplay!==5&&(p={maxHeight:`${e.maxItemsDisplay*32+33}px`}),p});return fe(()=>{if(document.addEventListener("scroll",o,!0),window.addEventListener("resize",u),e.scrollTop>0&&i.value)i.value.scrollTop=e.scrollTop;else if(e.highlighIndex>-1){let p=e.highlighIndex*36;i.value.scrollTop=p}pe(()=>{a.value&&(l=a.value.clientWidth)})}),me(()=>{document.removeEventListener("scroll",o,!0),window.removeEventListener("resize",u),t("update:scrollTop",n._scrollTop)}),{menuBodyCon:i,dropdownContainer:a,headerStyle:c,headerWidth:x,dropdownStyles:ne,dropdownBodyStyle:ie,addNewClick:f,getThStyle:r,onDocumentClick:s,onDropdownMenuScroll:d}}}),dt={class:"dropdown-header"},st={class:"dropdown-items"},ut={key:1,class:"dropdown-items"},ct={key:0,class:"dropdown--loading"},ft={class:"no-data-display__text"};function pt(e,t,l,n,i,a){return m(),y("div",{class:"combo-dropdown-panel",style:b(e.dropdownStyles),ref:"dropdownContainer"},[h("div",{ref:"menuBodyCon",class:"dropdown-body-container scroller-overlay",onScroll:t[0]||(t[0]=W((...r)=>e.onDropdownMenuScroll&&e.onDropdownMenuScroll(...r),["stop"])),style:b(e.dropdownBodyStyle)},[e.columns&&e.columns.length>0?(m(),y("table",{key:0,class:"dropdown-table",style:b(e.headerStyle)},[h("thead",dt,[h("tr",null,[(m(!0),y(I,null,D(e.columns,(r,s)=>(m(),y("th",{class:F(["dropdown-header__th",{th_multi:e.isMulti}]),key:s,style:b(e.getThStyle(r))},[h("span",null,w(r.title),1)],6))),128))])]),h("tbody",st,[k(e.$slots,"default",{},void 0,!0)])],4)):(m(),y("div",ut,[k(e.$slots,"default",{},void 0,!0)]))],36),e.loading?(m(),y("div",ct,t[2]||(t[2]=[h("div",{class:"loading-svg"},[h("div",{class:"effect-1 effects"})],-1)]))):e.showEmptyText?(m(),y("div",{key:1,class:"no-data-display",onClick:t[1]||(t[1]=W(()=>{},["stop"]))},[h("div",ft,w(e.$t("i18nCommon.dataEmpty")),1)])):S("",!0)],4)}const mt=V(ot,[["render",pt],["__scopeId","data-v-495bf461"]]),ht=M({name:"MsComboboxTreeItem",emits:["itemClick","toogleExpand"],props:{selectedValue:{},item:{},columns:{type:Array,default:new Array},valueField:{type:String,default:null},displayField:{type:String,default:null},formatType:{type:[Number,String],default:null},align:{type:String,default:"left"},activeValue:{}},setup(e,{emit:t}){const{proxy:l}=O();return{toogleExpand:(o,u)=>{u.preventDefault(),u.cancel=!0,o.expanded=!o.expanded,t("toogleExpand",o,o.expanded)},getCellStyle:(o,u)=>{if(o.isResize&&l.$refs[`td-${u}`]&&l.$refs[`td-${u}`].length>0){let c=l.$refs[`td-${u}`][0].getBoundingClientRect(),x=l.$parent.$el.getBoundingClientRect();return c.right<=x.right?{width:c.width+(x.right-c.right)+"px",textAlign:o.columnAlign}:{width:`${o.width}px`,textAlign:o.columnAlign}}return{width:o.isResize?null:`${o.width}px`,textAlign:o.columnAlign}},getItemDisplay:(o,u)=>{let f=u?u.dataField:e.displayField||e.valueField,c="";return f?c=o[f]:c=o,l.$ms.commonFn.processXssValue(c)},onItemClick:(o,u)=>{u.cancel||t("itemClick",o,u)},getThStyle:o=>({width:o.isResize?null:`${o.width}px`,maxWidth:o.isResize?null:`${o.width}px`,textAlign:o.columnAlign}),onChildToogleExpand:(o,u)=>{t("toogleExpand",o,u)}}}}),yt=["title"],gt={class:"flex-row"},vt={class:"combobox-item--text"},xt=["title"],It={class:"flex-row"},St={class:"combobox-item--text"};function Ft(e,t,l,n,i,a){const r=C("ms-combobox-tree-item",!0);return e.columns&&e.columns.length>1?(m(),y(I,{key:0},[h("tr",{class:F(["combobox-item",{parent:e.item.IsParent,checked:e.selectedValue===e.item[e.valueField],active:e.activeValue==e.item[e.valueField],"combobox-item--highlight":e.activeValue==e.item[e.valueField]}]),onClick:t[0]||(t[0]=s=>e.onItemClick(e.item,s))},[(m(!0),y(I,null,D(e.columns,(s,d)=>(m(),y("td",{class:F(["combobox-item-td",d===0?`level-${e.item.level}`:null]),title:e.getItemDisplay(e.item,s),style:b(e.getThStyle(s)),ref_for:!0,ref:`td-${d}`,key:s.dataField},[h("div",gt,[h("div",vt,w(e.getItemDisplay(e.item,s)),1)])],14,yt))),128))],2),e.item.expanded?(m(!0),y(I,{key:0},D(e.item.childNodes,s=>(m(),T(r,{key:s[e.valueField],item:s,columns:e.columns,valueField:e.valueField,displayField:e.displayField,onItemClick:e.onItemClick,selectedValue:e.selectedValue,onToogleExpand:e.onChildToogleExpand,activeValue:e.activeValue},null,8,["item","columns","valueField","displayField","onItemClick","selectedValue","onToogleExpand","activeValue"]))),128)):S("",!0)],64)):(m(),y(I,{key:1},[h("div",{class:F(["combobox-item",{parent:e.item.IsParent,checked:e.selectedValue===e.item[e.valueField],active:e.activeValue==e.item[e.valueField],"combobox-item--highlight":e.activeValue==e.item[e.valueField]}]),onClick:t[1]||(t[1]=s=>e.onItemClick(e.item,s))},[h("div",{class:F(`level-${e.item.level}`),title:e.item[e.displayField]},[h("div",It,[h("div",St,w(e.item[e.displayField]),1)])],10,xt)],2),e.item.expanded?(m(!0),y(I,{key:0},D(e.item.childNodes,s=>(m(),T(r,{key:s[e.valueField],item:s,columns:e.columns,valueField:e.valueField,displayField:e.displayField,onItemClick:e.onItemClick,selectedValue:e.selectedValue,onToogleExpand:e.onChildToogleExpand,activeValue:e.activeValue},null,8,["item","columns","valueField","displayField","onItemClick","selectedValue","onToogleExpand","activeValue"]))),128)):S("",!0)],64))}const wt=V(ht,[["render",Ft],["__scopeId","data-v-fde35c82"]]),bt=M({name:"MsComboboxTree",extends:ye,mixins:[he],components:{MsComboboxTreeDropdown:mt,MsComboboxTreeItem:wt},emits:["msKeydown","comboboxLoadData","blur","beforeQuery","autoSelected","update:modelValue","update:display","selected","beforeExpand","change","click","input"],props:{modelValue:{},placeholder:{default:null,type:[Number,String]},maxItemsDisplay:{default:10,type:Number},columns:{type:Array,default:()=>[]},textRequired:{type:String,default:"*",required:!1},valueField:{type:String,default:null},displayField:{type:String,default:null},data:{default:()=>[],type:Array},itemSize:{default:28,type:Number},forceSelection:{default:!0,type:Boolean},idProperty:{default:"id",type:String},parentIdProperty:{default:"parent_id",type:String},notSelectionParent:{default:!1,type:Boolean},dropdownWidth:{default:null,type:[String,Number]},queryMode:{type:String,default:"local"},initText:{default:null,type:[Number,String]},selectOnly:{default:!1,type:Boolean},autoLoad:{default:!1,type:Boolean},mappingField:{default:null},keyField:{type:String},maxLength:{default:null,type:Number},requestField:{type:String,default:null},buildFilter:{type:Function,default:null},isReload:{type:Boolean,default:!1},pageSize:{type:Number,default:10},rules:{default:[{name:"forceSelection"}],type:Array},expandAll:{type:Boolean,default:!1},isAsyncBeforeExpand:{type:Boolean,default:!1},pushElmTop:{type:Boolean,default:!1},showRootSearch:{type:Boolean,default:!0},isQueryLocalFilterParent:{type:Boolean,default:!1}},setup(e){const{errorMessage:t,handlerValidateCombobox:l,getTitleError:n,clearValidate:i}=xe({props:e}),{proxy:a}=O();return{errorMessage:t,validate:()=>a.isGridEditor?"":l(),getTitleError:n,clearValidate:i}},computed:{listeners(){const e=this;return{input:t=>e.onInput(t),focus:t=>e.onFocus(t),change:t=>e.onChange(t),blur:t=>e.onBlur(t),keydown:t=>e.onKeydown(t),click:t=>e.onClick(t)}}},data(){return this.initStaticData(),{internalDataSource:[],internalText:null,expanded:!1,dropdownTopx:0,dropdownLeftx:0,internalSelectedItem:null,typeAheadPointer:-1,focused:!1,gridItemSize:48,dropdownScrollTop:0,loading:!1,lastRequestParam:null,dropdownMinWidthx:null,dropdownMaxWidthx:null,activeItem:null,isShowTextEmpty:!1,internalFlattenDataSource:{type:Array,default:[]}}},watch:{data:{inmediate:!0,handler(e){const t=this;t.loading&&(t.loading=!1),e==null?(t.lastQueryString=new Date().getTime(),t._allData=null):(t.queryMode!=="remote"&&(t._allData=e),t.internalDataSource!=e&&!(t.internalDataSource.length===0&&e.length===0)?(t.initData(),t.isValid(t.modelValue)&&t.doSelectValue(t.modelValue)):t.internalDataSource.length===0&&e.length===0&&(t.isShowTextEmpty=!0))}},initText:{immediate:!0,handler(e,t){(e||t)&&this.setInitText(e)}},modelValue:{immediate:!0,handler(e,t){let l=this;if(l.isValid(e))l.$nextTick(()=>{l.doSelectValue(e,t)});else{const n=this;n.internalSelectedItem=null,n.typeAheadPointer=-1,n.internalValue=null,n.activeItem=null,n.$emit("update:modelValue",n.internalValue),n.$emit("update:display","")}}},internalText:{immediate:!0,handler(e,t){let l=this;!e&&l.expanded&&(l.activeItem=null)}}},created(){const e=this;e.initIndex=0,e.initData(),e.autoLoad&&e.doQueryInternal(null,!1),q.$on(z.scrollEvent,e.scrollEvent)},mounted(){const e=this;e.queryMode!="remote"&&(e.internalQueryDelay=500),e.doQuery=ve(e.doQueryInternal,e.internalQueryDelay),document.addEventListener("click",e.click_out)},methods:{isValid(e){return typeof e=="object"?!ge(e):e!==void 0},doSelectValue(e){let t=this,l=t.getItemByValue(e);t.isValid(l)&&t.setInternalItem(l,!0)},getItemByValue(e,t){let l=this,n;return l.isValid(e)&&(l._allData&&l._allData.length>0?n=l._allData.find(i=>K(i[l.valueField],e)):n=l.internalDataSource.find(i=>K(i[l.valueField],e)),!n&&!t&&(n={[l.valueField]:l.modelValue,[l.displayField]:l.initText})),n||null},flattenArray(e){let t=[],l=this;return e.forEach((n,i)=>{n.childNodes&&Array.isArray(n.childNodes)?(t.push(n),t=t.concat(l.flattenArray(n.childNodes))):t.push(n)}),t},getValue(){return this.internalText},isNullOrEmptyvalue(){return this.modelValue==null||this.modelValue=={}},scrollEvent(){const e=this;e.expanded&&e.collapse()},setInitText(e){const t=this;t.internalText=t.initText?t.initText:e},doQueryInternal(e,t){let l=this,n={preventDefault:!1,sender:l},i=e;if(l.$emit("beforeQuery",n),n.preventDefault)return!1;l.lastQueryString===i&&!l.isReload||(l.dropdownScrollTop=0,l.internalDataSource=[],l.lastQueryString=i,l.querying=!0,l.queryMode==="remote"&&!l._allData?l.doRemoteQuery(i):l.$nextTick(()=>{l.doLocalQuery(i),l.initData(),t&&!l.expanded||i&&(l.doHightlightItem(!0),l.setActive(l.internalDataSource[0]))}))},doRemoteQuery(e){let t=this,l=[],n=t.filterFields||{};return new Promise((i,a)=>{try{if(e){const d={},o=Object.keys(n);let u={Field:o[0],Operator:n[o[0]],Value:e};if(l.push(u),o.length>1){u.Ors=[];for(let f=1;f<o.length;f++)u.Ors.push({Field:o[f],Operator:n[o[f]],Value:e})}}let r={};r.skip=0,r.take=t.pageSize,r.pageAppend=!1,l.length>0&&(r.filter=JSON.stringify(l));let s=[t.displayField,t.valueField];if(t.columns&&t.columns.length>0&&t.columns.forEach(d=>{d.dataField&&s.indexOf(d.dataField)===-1&&s.push(d.dataField)}),t.mappingField)for(let d in t.mappingField)s.indexOf(d)===-1&&s.push(d);t.requestField&&t.requestField.split(",").forEach(d=>{d&&s.indexOf(d)&&s.push(d)}),s=s.distinctKey(s),r.columns=s.join(","),t.lastRequestParam=r,typeof t.buildFilter=="function"&&t.buildFilter(r),t.loading=!0,t.modelValue&&Object.assign(r,{selectedItem:JSON.stringify({[t.valueField]:t.modelValue})}),t.$emit("comboboxLoadData",r),i()}catch(r){a(r)}})},doLocalQuery(e){const t=this;if(e){let l=t.filterData(e),n={},i=[],a=function(r){let s=r[t.idProperty];if(n.hasOwnProperty(r[s]))return;n[s]=r,delete r.expanded,delete r.childNodes,delete r.isParent;let d=r,o=d[t.parentIdProperty],u=r;for(;o;){let f=t._parents[o];if(!f)break;if(u=n[o],!u)u={...f},u.childNodes=[],n[o]=u;else if(u.childNodes)for(let c=0;c<u.childNodes.length;c++){let x=u.childNodes[c];if(d[t.idProperty]===x[t.idProperty])return}u.expanded=!0,u.isParent=!0,u.childNodes=u.childNodes||[],u.childNodes.push(d),d=u,o=u[t.parentIdProperty]}if(u){let f=!1;for(let c=0;c<i.length;c++)if(u[t.idProperty]===i[c][t.idProperty]){f=!0;break}!f&&!u.ParentId&&i.push(u)}};if(t.isQueryLocalFilterParent)for(let r=0;r<l.length;r++){let s={...l[r]};t.showRootSearch?a(s):i.push(s)}else i=l;if(i.length>1){let r=function(s){let d=s.sortObject("_ix");for(let o=0;o<d.length;o++)Array.isArray(d[o].childNodes)&&d[o].childNodes.length>0&&r(d[o].childNodes);return d};i=r(i)}t.internalDataSource=i,t.internalFlattenDataSource=[...t.flattenArray(t.internalDataSource)],t.createDisplayMap()}else{if(t.internalDataSource=t._allTreeData,t.expandAll)t.expandAllNode();else if(Array.isArray(t.internalDataSource)){let l=!0;for(let n=0;n<t.internalDataSource.length;n++){let i=t.internalDataSource[n];if(t.resetExpand(i,!0),l&&Array.isArray(i.childNodes)&&i.childNodes.length>0){l=!1;let a=i.childNodes[0];t.resetExpand(a,!0)}}}t.internalFlattenDataSource=[...t.flattenArray(t.internalDataSource)]}t.internalDataSource<=0?t.isShowTextEmpty=!0:t.isShowTextEmpty=!1},createDisplayMap(){const e=this;let t={},l=function(n,i){for(let a=0;a<n.length;a++){let r=n[a];t[r[e.valueField]]=r,Array.isArray(r.childNodes)&&r.childNodes.length>0&&l(r.childNodes)}};l(e.internalDataSource),e._sourceMap=t},expandAllNode(e=this.internalDataSource){if(!Array.isArray(e))return;const t=this;for(let l=0;l<e.length;l++){let n=e[l];t.resetExpand(n,!0),Array.isArray(n.childNodes)&&n.childNodes.length>0&&t.expandAllNode(n.childNodes)}},resetExpand(e,t){const l=this;if(e.expanded=t,e.childNodes&&e.childNodes.length>0)for(let n=0;n<e.childNodes.length;n++){let i=e.childNodes[n];l.resetExpand(i,!0)}},filterData(e){const t=this;let l=[];return e?t._allData.forEach(n=>{let i=!1;for(let a in t.filterFields){let r=n[a];if(t.testFilter(t.filterFields[a],r,e.trim())){i=!0;break}}i&&l.push(n)}):l=t._allData,t.nomalizeDataTree(l,t.idProperty||t.valueField,t.parentIdProperty)},getQueryString(){return(this.internalText||"").trim()},click_out(e){const t=this;!t.$ms.commonFn.hasParent(e.target,t.$el)&&t.$refs.dropdownPanel&&t.$refs.dropdownPanel.$el&&!t.$ms.commonFn.hasParent(e.target,t.$refs.dropdownPanel.$el)&&t.collapse()},reset(){const e=this;e.internalText="",e.internalSelectedItem=null,e.internalValue=null,e.$emit("update:modelValue",e.internalValue),e.$emit("update:display","")},setInternalText(e){const t=this;t.internalText=e},setValue(e,t=!1){const l=this;l.internalValue=e,l.$emit("update:modelValue",l.internalValue)},onInput(e,t=!1){const l=this;if(l._typing=!0,!l.expanded&&!(l.internalSelectedItem&&!l.internalText))l.expand();else if(!l.expanded&&l.internalSelectedItem&&!l.internalText){let n={oldData:l.internalSelectedItem,newData:null};l.$emit("selected",n),l.reset();return}if(!l.internalText){let n={oldData:l.internalSelectedItem,newData:null};l.$emit("selected",n),l.reset()}t?l.doQuery(null,!0):l.doQuery(l.internalText,!0),l._typing=!1,!l.forceSelection&&l.valueField==l.displayField&&(l.internalValue=l.internalText,l.$emit("update:modelValue",l.internalValue))},doHightlightItem(e){const t=this;let l=-1;if(t.internalDataSource&&t.internalDataSource.length>0){if(l=-1,!e&&t.internalValue!=null&&t.internalValue!=null){let n=t._allData||t.internalDataSource;for(let i=0;i<n.length;i++)if(n[i][t.valueField]===t.internalValue){l=i;break}}if(l===-1&&t.internalText){let n=t.internalText.toLowerCase();if(t.columns&&t.columns.length>0)for(let i=0;i<t.internalDataSource.length;i++){let a=t.internalDataSource[i];for(let r=0;r<t.columns.length;r++){let s=t.columns[r].dataField,d=a[s];if(typeof d=="string"&&d.toLowerCase().indexOf(n)>-1){l=i;break}}if(l>-1)break}else for(let i=0;i<t.internalDataSource.length;i++){let a=t.internalDataSource[i][t.displayField];if(typeof a=="string"&&a.toLowerCase().indexOf(n)>-1){l=i;break}}}}t.typeAheadPointer=l},adjustScroll(e=this.typeAheadPointer){var l,n,i,a,r,s;const t=(n=(l=this.$refs.dropdownPanel)==null?void 0:l.$el)==null?void 0:n.querySelector(".combobox-item");if(t){const d=t.getBoundingClientRect().height;let o=this.getScroller();if(o){let u=(a=(i=this.$refs.dropdownPanel)==null?void 0:i.$el)==null?void 0:a.querySelector(".combobox-item.checked");if(!u)return;let f=(s=(r=this.$refs.dropdownPanel)==null?void 0:r.$el)==null?void 0:s.querySelectorAll(".combobox-item"),c=Array.prototype.indexOf.call(f,u);o.scrollTop=(Number.parseInt(d)-1)*c}}},onClick(e){this.$emit("click",e),this.triggerClick(e)},onFocus(e){const t=this;t.focused=!0,e.target.select()},onChange(){},onBlur(e){const t=this;t.focused=!1,t.$nextTick(()=>{setTimeout(()=>{t.validateBlur()},10)}),t.$emit("blur",e)},onKeydown(e){const t=this;e.keyCode!==13&&e.keyCode!==27&&e.stopPropagation();let l=!0;switch(e.which){case 40:t.downKeyAction(e),l=!1;break;case 38:t.prevKeyAction(e),l=!1;break;case 13:t.enterKeyAction(e);break;case 9:t.tabKeyAction(e);break}l&&t.$emit("msKeydown",e)},tabKeyAction(){const e=this;if(e.expanded&&e.activeItem){let t=e._nodes[e.activeItem[e.valueField]];e.setInternalItem(t)}e.collapse()},enterKeyAction(){const e=this;if(e.expanded&&e.activeItem){let t=e._nodes[e.activeItem[e.valueField]];e.setInternalItem(t)}e.collapse()},rightKeyAction(e){const t=this;if(!(!t.expanded||!t.activeItem)&&(stopEvent(e),Array.isArray(t.activeItem.childNodes)&&t.activeItem.childNodes.length>0)){t.activeItem.expanded=!0;return}},leftKeyAction(e){const t=this;if(!t.expanded||!t.activeItem)return;if(stopEvent(e),t.activeItem.expanded&&Array.isArray(t.activeItem.childNodes)&&t.activeItem.childNodes.length>0){let n=t.activeItem[t.valueField],i=t.findNodeById(n);i&&(i.expanded=!1);return}let l=t.activeItem.ParentId;if(l){let n=t.findNodeById(l);t.setActive(n)}},prevKeyAction(e){const t=this;if(!t.expanded||(stopEvent(e),!t.activeItem))return;let l=function(i){i.expanded&&Array.isArray(i.childNodes)&&i.childNodes.length>0?l(i.childNodes[i.childNodes.length-1]):(t.activeItem[t.displayField]===t.internalText&&t.setTextDisplay(i),t.setActive(i))},n=function(i,a){let r=i[t.valueField],s=a==null?void 0:a.length;for(let d=0;d<s;d++)if(a[d][t.valueField]==r)return d===0?!1:(l(a[d-1]),!0);return!1};if(t.internalText){let i=t.internalFlattenDataSource.findIndex(a=>a[t.valueField]===t.activeItem[t.valueField]);i>0?(t.activeItem[t.displayField]===t.internalText&&t.setTextDisplay(t.internalFlattenDataSource[i-1]),t.setActive(t.internalFlattenDataSource[i-1])):(t.activeItem[t.displayField]===t.internalText&&t.setTextDisplay(t.internalFlattenDataSource[0]),t.setActive(t.internalFlattenDataSource[0]))}else{let i=t.activeItem.ParentId;if(i){let a=t.findNodeById(i);n(t.activeItem,a.childNodes)||(t.setTextDisplay(a),t.setActive(a))}else n(t.activeItem,t.internalDataSource)}t.setInternalItem(t.activeItem)},downKeyAction(e){const t=this;if(stopEvent(e),!t.expanded){t.expand(),t.doQueryInternal(null,!0),t.internalText||(t.activeItem=null);return}const l=t.internalDataSource;if(!t.activeItem&&t.expanded)Array.isArray(l)&&l.length>0&&(t.setActive(l[0]),t.internalText||t.setTextDisplay(l[0]));else if(t.activeItem.IsParent&&t.activeItem.expanded&&Array.isArray(t.activeItem.childNodes)&&t.activeItem.childNodes.length>0)t.activeItem[t.displayField]===t.internalText&&t.setTextDisplay(t.activeItem.childNodes[0]),t.setActive(t.activeItem.childNodes[0]);else{let n=function(a,r){let s=a[t.valueField],d=r.length-1;for(let o=0;o<d;o++)if(r[o][t.valueField]==s)return t.setActive(r[o+1]),!0;return!1},i=function(a){if(t.internalText){let r=t.internalFlattenDataSource.findIndex(s=>s[t.valueField]===t.activeItem[t.valueField]);t.activeItem[t.displayField]===t.internalText&&t.setTextDisplay(t.internalFlattenDataSource[r+1]),r<t.internalFlattenDataSource.length-1?t.setActive(t.internalFlattenDataSource[r+1]):t.setActive(t.internalFlattenDataSource[t.internalFlattenDataSource.length-1])}else{let r=a.ParentId;if(r){let s=t.findNodeById(r);n(a,s.childNodes)||i(s)}else n(a,l)}};i(t.activeItem)}t.setInternalItem(t.activeItem)},setTextDisplay(e){let t=this;e&&(t.internalText=e[t.displayField])},findNodeById(e){const t=this;let l=t._sourceMap||t._nodes;if(!l[e]){let n={};return t.internalFlattenDataSource.forEach(i=>{n[i[t.valueField]]=i}),n[e]}return l[e]},getTotalData(){return this.internalDataSource.length},filterIndexItemByText(e){const t=this;let l=t.filterFields,n=e||t.internalText,i=-1;return l&&n&&(n=n.toString(),i=t.internalDataSource.findIndex((a,r)=>{let s=!1;for(const d in l)if(l.hasOwnProperty(d)&&(l[d]=="*"?s=a[d]&&a[d].toString()&&a[d].toString().toLowerCase().contains(n.toLowerCase()):s=a[d]&&a[d].toString()&&a[d].toString().toLowerCase().startsWith(n.toLowerCase()),s))break;return s})),i},findItemByText(e){return!e||!this.internalFlattenDataSource||this.internalFlattenDataSource.length===0?!1:this.internalFlattenDataSource.filter(t=>{let l=t[this.displayField];if(e===l)return t})},getFilterFields(){let e={};if(this.columns&&this.columns.length>0)for(let t=0;t<this.columns.length;t++){const l=this.columns[t];l.filterOperator||(l.filterOperator=this.$ms.constant.FilterOperator.Contains),l.dataField&&l.filterOperator&&(this.filterColumns&&this.filterColumns.length>0?this.filterColumns.forEach(n=>{e.hasOwnProperty(n)||(e[n]=l.filterOperator)}):e[l.dataField]=l.filterOperator)}else e[this.displayField]=this.$ms.constant.FilterOperator.Contains;return e},getScroller(){if(this.expanded){let e=this.$refs.dropdownPanel;if(e&&e.$el&&typeof e.$el.querySelector=="function")return e.$el.querySelector(".scroller-overlay")}return null},onItemClick(e,t){const l=this;t.preventDefault(),l.notSelectionParent&&e.IsParent?e.expanded=!e.expanded:(l.setInternalItem(e),l.collapse(),l.adjustScroll(),l.validate(l))},setInternalItem(e,t=!1){const l=this;if(e){if(l.clearValidate&&l.clearValidate(),l.notSelectionParent&&e.IsParent)return;if(!l.internalSelectedItem||l.internalSelectedItem[l.valueField]!==e[l.valueField]){let n={};if(n[l.valueField]=l.internalValue,n[l.displayField]=l.internalText,l.internalSelectedItem=e,l.internalValue=e[l.valueField],l.$emit("update:modelValue",l.internalValue),l.internalText=e[l.displayField],l.$emit("update:display",l.internalText),!t){let i={oldData:n,newData:e,userAction:t};l.$emit("selected",i),l.$nextTick(()=>{l.$refs.input&&(l.$refs.input.focus(),l.$refs.input.select())})}l.pushElmTop&&(l.dropdownScrollTop=0)}}},findIndexItem(e){return this.internalDataSource.findIndex(l=>l==e)},initStaticData(){const e=this;e.internalQueryDelay=200,e.filterFields=e.getFilterFields(),e.internalValue=null,e.firstExpand=!0},initData(){const e=this;let t=e.nomalizeDataTree(e.data,e.idProperty||e.valueField,e.parentIdProperty);e.keyField&&e.keyField!==e.valueField&&e.$ms.commonFn.genVKeyValue(e.internalDataSource,e.keyField),e._allTreeData=t;let l=e.$ms.commonFn.getBodyData(t,!0);l.length>0?(e.internalDataSource=e._allData=l,e.doLocalQuery(e.lastQueryString)):(e.internalDataSource=[],e._allData=null),e.internalFlattenDataSource=[...e.flattenArray(e.internalDataSource)],e.modelValue!=null&&e.pushElmTop&&e.pushElementSelected(e.internalDataSource)},pushElementSelected(e){const t=this;e.forEach(l=>{var n;if(l[t.idProperty]==t.modelValue){let i=e.findIndex(a=>a[t.idProperty]==t.modelValue);if(i!=-1){let a=e.splice(i,1)[0];t.internalDataSource.unshift(a)}return-1}else l.hasOwnProperty("childNodes")&&((n=l.childNodes)==null?void 0:n.length)>0&&t.pushElementSelected(l.childNodes)})},nomalizeDataTree(e,t,l){const n=this;let i=[...e],a=[],r={},s={},d=function(o){if(!r.hasOwnProperty(o)){let u=at(i,f=>f[t]===o);r[o]=u}return r[o]};i.forEach(o=>{o.childNodes&&delete o.childNodes});for(let o=0;o<i.length;o++){let u=i[o];s[u[n.valueField]]=u,u._ix=o;let f=u[l];if(f){let c=d(f);c?(c.hasOwnProperty("childNodes")||(c.childNodes=[]),c.hasOwnProperty("IsParent")||(c.IsParent=!0),c.childNodes.push(u),u.ParentId=c[n.valueField]):a.push(u)}else a.push(u)}return n._nodes=s,n._parents=r,a},triggerClick(e){const t=this,l=t.expanded;t.disabled||(l||(t.onInput(e,!0),t.initData()),t.$nextTick(()=>{l&&(t.expanded=!l)}),t.$refs.input&&(t.$refs.input.focus(),t.$refs.input.select()))},expand(){const e=this;e.isAsyncBeforeExpand?e.$emit("beforeExpand",e.funcDoExpand,e):(e.$emit("beforeExpand"),e.funcDoExpand())},funcDoExpand(){let e=this;e.changeDropdownPosition(),e.$nextTick(()=>{e.expanded=!0,e.$nextTick(()=>{e.adjustScroll()})})},collapse(){const e=this;e.$nextTick(()=>{e.expanded&&e.rules&&!e.rules.some(t=>t.name===e.$ms.constant.ValidateRule.ForceSelection)&&e.valueField===e.displayField&&e.$emit("selected",e.internalValue),e.expanded=!1})},changeDropdownPosition(){let e=this,t=e.$el;if(t&&(t=t.getElementsByClassName("combo-box-input")[0]),t){let l=t.getBoundingClientRect(),n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;e.dropdownLeftx=l.left,e.dropdownMaxWidthx=e.dropdownMinWidthx=e.dropdownWidth?parseInt(e.dropdownWidth):l.width,l.left+e.dropdownMaxWidthx>n&&(e.dropdownLeftx=l.right-e.dropdownMaxWidthx),e.dropdownTopx||(e.dropdownTopx=l.top+l.height+2),e.$nextTick(()=>{setTimeout(()=>{let a=e.$refs.dropdownPanel;if(a&&a.$el){let r=a.$el.getBoundingClientRect();e.pushElmTop&&(a.$refs.menuBodyCon.scrollTop=0),l.top+l.height+r.height+10>i?e.dropdownTopx=l.top-r.height-2:e.dropdownTopx=l.top+l.height+2}},0)})}},validateBlur(){this.validate(this)},onEsc(e){const t=this;t.expanded&&(t.collapse(),e.preventDefault(),e.cancel=!0)},onEnter(e){const t=this;t.expanded&&!t.loading&&t.internalDataSource.length===0&&(e.preventDefault(),e.stopPropagation())},itemToogleExpand(e,t){this.setActive(e)},setActive(e){const t=this;t.activeItem=e,t.$nextTick(()=>{let l=t.$refs.dropdownPanel.$el.querySelector(".active");l&&typeof l.scrollIntoViewIfNeeded=="function"&&l.scrollIntoViewIfNeeded(),t.focusInput()})},focusInput(){this.$refs.input.focus()}},beforeUnmount(){const e=this;e.collapse(),e.$refs.dropdownPanel&&e.$refs.dropdownPanel.$el.remove(),q.$off(z.scrollEvent,e.scrollEvent),document.removeEventListener("click",e.click_out)}}),Dt={class:"ms-combobox ms-editor data-input ms-validate"},Tt={class:"flex"},$t={key:0,class:"label mb-2"},Et={key:1,class:"ms-textarea-required"},At=["title","placeholder","disabled","readOnly","maxlength"],Nt={key:0,class:"error-message"};function kt(e,t,l,n,i,a){const r=C("ms-combobox-tree-item"),s=C("ms-combobox-tree-dropdown");return m(),y("div",Dt,[h("div",Tt,[e.label?(m(),y("label",$t,w(e.label),1)):S("",!0),e.rules&&e.rules.find(d=>(d==null?void 0:d.name)=="required")?(m(),y("div",Et,"  "+w(e.textRequired),1)):S("",!0),k(e.$slots,"labelCustom",{},void 0,!0)]),h("div",{class:F(["flex-row flex combo-box-input",[{"input-error":e.errorMessage,disabled:e.disabled}]])},[Ie(h("input",Fe({title:e.internalText,ref:"input",class:"input flex",placeholder:e.placeholder,"onUpdate:modelValue":t[0]||(t[0]=d=>e.internalText=d)},we(e.listeners,!0),{disabled:e.disabled,readOnly:e.readOnly||e.selectOnly,maxlength:e.maxLength,class:{disabled:e.disabled},onKeydown:[t[1]||(t[1]=H((...d)=>e.onEsc&&e.onEsc(...d),["esc"])),t[2]||(t[2]=H((...d)=>e.onEnter&&e.onEnter(...d),["enter"]))]}),null,16,At),[[Se,e.internalText]]),h("div",{onClick:t[3]||(t[3]=(...d)=>e.triggerClick&&e.triggerClick(...d)),class:F(["icon-combo--dropdown",{disabled:e.disabled,"point-event-none":e.readOnly,expand:e.expanded}])},null,2)],2),e.errorMessage?(m(),y("div",Nt,w(e.errorMessage),1)):S("",!0),(m(),T(De,{to:"body"},[e.expanded?(m(),T(s,{key:0,ref:"dropdownPanel",topx:e.dropdownTopx,leftx:e.dropdownLeftx,maxWidthx:e.dropdownMaxWidthx,maxItemsDisplay:e.maxItemsDisplay,minWidthx:e.dropdownMinWidthx,columns:e.columns,highlighIndex:e.typeAheadPointer,scrollTop:e.dropdownScrollTop,loading:e.loading,showEmptyText:e.isShowTextEmpty},{default:be(()=>[(m(!0),y(I,null,D(e.internalDataSource,(d,o)=>(m(),T(r,{key:o,item:d,columns:e.columns,valueField:e.valueField,displayField:e.displayField,selectedValue:e.modelValue,onItemClick:e.onItemClick,onToogleExpand:e.itemToogleExpand,activeValue:e.activeItem?e.activeItem[e.valueField]:null},null,8,["item","columns","valueField","displayField","selectedValue","onItemClick","onToogleExpand","activeValue"]))),128))]),_:1},8,["topx","leftx","maxWidthx","maxItemsDisplay","minWidthx","columns","highlighIndex","scrollTop","loading","showEmptyText"])):S("",!0)]))])}const Pt=V(bt,[["render",kt],["__scopeId","data-v-53eaf4da"]]);export{Pt as M};
