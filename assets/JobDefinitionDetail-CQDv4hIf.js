var S=Object.defineProperty;var N=(e,t,o)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var k=(e,t,o)=>N(e,typeof t!="symbol"?t+"":t,o);import{I as H,J as B,cu as I,g as C,cx as R,cK as f,T as _,_ as T,a as h,o as y,b as r,p as V,t as g,be as j,bL as A,d as P,r as w,e as J,j as b,m as x,w as M,k as c,v}from"./index-DmUMvrSQ.js";import{c as U}from"./crudBaseStore-BQfEd0nr.js";import{B as O}from"./BaseDetail-zykIlOpR.js";import{d as Y}from"./dictionaryAPI-B4HeeuwR.js";import{u as K}from"./remoteCombobox-B8Q4up6i.js";import"./validateComponent-kMK-YP6C.js";class z extends H{constructor(){super(...arguments);k(this,"apiName","dictionary");k(this,"controllerName","JobDefinition")}}const F=new z,$=new U({field:{key:"job_definition_id",code:"job_definition_code"}},F);class E{constructor(){k(this,"state",()=>({...$.state}));k(this,"actions",{...$.actions})}}const L=new E,W=B("moduleJobDefinition",L),G={extends:I,props:{autofocus:{type:Boolean,default:!1},modelValue:{required:!1,default:null},hasTimeInfo:{type:Boolean,default:!1},format:{type:String,default:"HH:mm:ss"},type:{type:String,default:""},placeholder:{type:String,default:"HH:mm"},defaultTime:{type:String,default:null},min:{},max:{},customWarring:{type:Object,default:null},hasBorder:{default:!0,type:Boolean},textRequired:{type:String,default:"*",required:!1}},computed:{listeners(){const e=this;return{input:t=>{(t.target.value=="__:__"||t.target.value=="_:__"||!t.target.value)&&e.$nextTick(()=>{e.updateVModel(null)})},change:t=>{e.onChange(t)},blur:t=>{e.onBlur(t)},keydown:t=>{e.$emit("msKeydown",t)},focus:t=>{e.momentMask.updateOptions({lazy:!1})},focusout:t=>{e.momentMask.updateOptions({lazy:!0})}}}},watch:{modelValue:{immediate:!0,handler(e,t){const o=this;o.setDefaultTime(e),o.setRawValue(e)}},min:{immediate:!0,handler(e,t){e&&this.updateMomentMask()}}},data(){return{topx:0,leftx:0,focused:!1,rawValue:""}},methods:{onKeydown(e){let t=this;switch(e.which){case 38:t.handleArrowKeyUpDown(e,!0);break;case 40:t.handleArrowKeyUpDown(e,!1);break}},handleArrowKeyUpDown(e,t){let o=this,s=o.momentMask.value,n=s.slice(0,10).match(/\//g);if(n&&n.length==2){let i=e.target.selectionStart,a=s.slice(0,10).split("/"),p=0,u=0;if(e.target.selectionEnd>9&&i==0&&(i=e.target.selectionEnd),i<=2){if(Number(a[0])){switch(p=0,u=2,t){case!0:if(Number(a[1])){let m=31;switch(Number(a[1])){case 2:let d=Number(a[2]);d&&(d%4==0&&d%100!=0||d%400==0)?m=29:m=28;break;case 4:case 6:case 9:case 11:m=30;break}a[0]<m&&(a[0]=Number(a[0])+1)}break;case!1:a[0]>1&&(a[0]=Number(a[0])-1);break}a[0]=a[0]+"",a[0].length<2&&(a[0]="0"+a[0])}}else if(i<=5){if(Number(a[1])){switch(p=3,u=5,t){case!0:a[1]<12&&(a[1]=Number(a[1])+1);break;case!1:a[1]>1&&(a[1]=Number(a[1])-1);break}a[1]=a[1]+"",a[1].length<2&&(a[1]="0"+a[1])}}else if(Number(a[2])){switch(p=6,u=10,t){case!0:a[2]=Number(a[2])+1;break;case!1:a[2]>1&&(a[2]=Number(a[2])-1);break}a[2]=a[2]+"",a[2].length<4&&(a[2]="0".repeat(4-a[2].length)+a[2])}o.rawValue=a.join("/")+o.rawValue.substring(10),o.momentMask.value=o.rawValue,o.$nextTick(()=>{e.target.selectionStart=i,o.$refs.input.setSelectionRange(p,u)}),e.preventDefault()}},setError(e){const t=this;setTimeout(()=>{t.errorMessage=e})},removeError(){let e=this;setTimeout(()=>{e.errorMessage="",e.errorProvider.isValid=!1,e.errorProvider.message="",e.errorProvider.element=this})},setDefaultTime(e){const t=this;if(t.defaultTime){let o=t.defaultTime.split(":");o&&o.length==3&&(e.setHours(o[0]),e.setMinutes(o[1]),e.setSeconds(o[2]))}},setRawValue(e,t){const o=this;if(e){let s=e;typeof e!="string"&&(s=o.$ms.format.formatDateTimeFull(e,o.format)),o.rawValue!==s&&(o.rawValue=s)}else o.rawValue=null;o.momentMask&&o.momentMask.value!=o.rawValue&&(o.rawValue?o.momentMask.value=o.rawValue:o.momentMask.value="")},onFocus(e){const t=this;t.focused=!0},onBlur(e){const t=this;t.focused=!1,t.$nextTick(()=>{t.validate(),t.$emit("onBlurActionDatePicker")})},onChange(e){const t=this,o=t.momentMask,s=o?o.masked:null,n=e.currentTarget.value;let i=t.autoNomalizeValue(n,s);t.$nextTick(()=>{i&&t.updateVModel(i)}),t.rules&&t.validate(t)},getValue(){return this.modelValue},autoNomalizeValue(e,t){const o=this;if(!t.unmaskedValue)o.updateVModel(null,o.modelValue,!1);else if(e&&typeof e=="string"&&t)if(!t.isComplete&&!t.date){let s=o.nomalizeDateTime(e,t);return s&&(o.momentMask.value=o.$ms.format.formatDateTimeFull(s,o.format)),s}else return o.nomalizeDateTime(e,t);return null},nomalizeDateTime(e,t){const o=this;try{if(e){if(e instanceof Date)return e;if(t&&t.rawInputValue){let s=t.parse(t.rawInputValue);if(s&&s.isValid()){let n=s.toDate(),i=new Date;return o.hasTimeInfo&&n&&n.getHours()==0&&(n.setHours(i.getHours()),n.setMinutes(i.getMinutes()),n.setSeconds(i.getSeconds()),n.setMilliseconds(i.getMilliseconds())),(n<t.min||n>t.max)&&n.setFullYear(i.getFullYear()),n&&(n=o.$ms.format.formatDateTimeFull(n,o.format)),n}}}}catch(s){console.error(s)}},maskInputComplete(){const e=this,t=e.momentMask,o=t?t.masked:null;if(o&&o.isComplete&&o.date){let s=e.$ms.format.formatDateTimeFull(o.date.toDate(),"HH:mm:ss"),n=e.$ms.format.formatDateTimeFull(e.modelValue,"HH:mm:ss");e.updateVModel(s,n,!0),e.$emit("changeValue",s,n)}},updateVModel(e,t,o=!0){const s=this;s.setRawValue(e),o&&s.$emit("msChange",e,s.oldDate),s.$emit("update:modelValue",e),o&&s.$emit("afterChange",e,s.oldDate),s.$nextTick(()=>{s.rules&&s.validate(s)})},initPicker(){const e=this;let t=e.$refs.input,o=e.format,s=f(t,{mask:Date,pattern:o,lazy:!0,min:e.min||new Date(1700,0,1),max:e.max||new Date(9999,12,31),format:function(n){return _(n).format(o)},parse:function(n){return _(n,o)},commit:e.momentMaskCommit,blocks:{YYYY:{mask:f.MaskedRange,from:1,to:9999},MM:{mask:f.MaskedRange,from:1,to:12},DD:{mask:f.MaskedRange,from:1,to:31},HH:{mask:f.MaskedRange,from:0,to:23},kk:{mask:f.MaskedRange,from:0,to:23},mm:{mask:f.MaskedRange,from:0,to:59},ss:{mask:f.MaskedRange,from:0,to:59},A:{mask:f.MaskedEnum,enum:["AM","PM","SA","CH"]},a:{mask:f.MaskedEnum,enum:["am","pm","sa","ch"]}}});s.on("complete",e.maskInputComplete),e.momentMask=s},updateMomentMask(){let e=this,t={min:e.min||new Date(1970,0,1),max:e.max||new Date(9999,12,31)};e.momentMask&&e.momentMask.updateOptions(t)}},setup(e,t){const{proxy:o}=C(),{errorMessage:s,validate:n,isValidate:i}=R({props:e});return{errorMessage:s,validate:n,isValidate:i}},mounted(){this.initPicker()},created(){},beforeUnmount(){}},Q={class:"calendar-container ms-time ms-editor ms-validate w-full"},X={class:"flex"},Z={key:0,class:"label mb-2"},ee={key:1,class:"ms-textarea-required"},te={ref:"buttonContainer",class:"form-input"},oe=["value","autofocus","disabled","readOnly","placeholder"],ae={key:0,class:"error-message"};function se(e,t,o,s,n,i){return y(),h("div",Q,[r("div",X,[e.label?(y(),h("label",Z,g(e.label),1)):V("",!0),e.rules&&e.rules.find(a=>(a==null?void 0:a.name)=="required")?(y(),h("div",ee," Â "+g(o.textRequired),1)):V("",!0)]),r("div",te,[r("input",j({ref:"input",class:["ms-input--datepicker input flex",{disabled:e.disabled,"input-error":s.errorMessage}],value:n.rawValue,tabindex:0,autofocus:o.autofocus,disabled:e.disabled,readOnly:e.readOnly,placeholder:o.placeholder},A(i.listeners,!0),{onKeydown:t[0]||(t[0]=(...a)=>i.onKeydown&&i.onKeydown(...a))}),null,16,oe),s.errorMessage?(y(),h("div",ae,g(s.errorMessage),1)):V("",!0)],512)])}const ne=T(G,[["render",se],["__scopeId","data-v-2a49e102"]]),ie=P({mixins:[],extends:O,components:{MsTime:ne},setup(){const{proxy:e}=C(),t=W(),o=w(F),s=w("job_definition"),{comboboxLoadData:n}=K(),i=J({frequency:[],status:[]});return{api:o,storeModule:t,subSystemCode:s,dataCombobox:i,dictionaryAPI:Y,filterFrequency:u=>{const m=e,d=["dictionary_list_code","=","TanSuatJob"];m.$ms.commonFn.concatFilter(u,d)},filterStatus:u=>{const m=e,d=["dictionary_list_code","=","TrangThaiChung"];m.$ms.commonFn.concatFilter(u,d)},comboboxLoadData:n}}}),le={ref:"slot-content",class:"form-content-popup"},re={class:"form-container mt-4"},me={class:"form-detail"},de={class:"flex form-group",style:{gap:"8px"}},ue={class:"flex form-group",style:{gap:"8px"}},fe={class:"flex form-group",style:{gap:"8px"}},ce={class:"form-action"},pe={class:"form-action_container"},be={class:"form-action_item"},ke={class:"form-action_item"};function ye(e,t,o,s,n,i){const a=b("ms-input"),p=b("ms-time"),u=b("ms-datepicker"),m=b("ms-combobox-v2"),d=b("ms-button"),q=b("ms-dynamic-popup");return y(),x(q,{width:750,height:450,title:`${e.editMode?e.$ms.commonFn.getEnumResource(e.editMode,"FormState"):""} ${e.$t("i18nJobDefinition.Title")}`,onBeforeOpen:e.beforeOpen},{content:M(({close:D})=>[r("div",le,[r("div",re,[r("div",me,[r("div",de,[c(a,{maxLength:30,rules:[{name:"required"}],label:e.$t("i18nJobDefinition.Detail.job_definition_code"),modelValue:e.model.job_definition_code,"onUpdate:modelValue":t[0]||(t[0]=l=>e.model.job_definition_code=l)},null,8,["label","modelValue"]),c(a,{maxLength:150,rules:[{name:"required"}],label:e.$t("i18nJobDefinition.Detail.job_definition_name"),modelValue:e.model.job_definition_name,"onUpdate:modelValue":t[1]||(t[1]=l=>e.model.job_definition_name=l)},null,8,["label","modelValue"])]),r("div",ue,[c(p,{label:e.$t("i18nJobDefinition.Detail.start_time"),modelValue:e.model.start_time,"onUpdate:modelValue":t[2]||(t[2]=l=>e.model.start_time=l)},null,8,["label","modelValue"]),c(u,{label:e.$t("i18nJobDefinition.Detail.last_success_time"),modelValue:e.model.last_success_time,"onUpdate:modelValue":t[3]||(t[3]=l=>e.model.last_success_time=l),format:"DD/MM/YYYY HH:mm"},null,8,["label","modelValue"])]),r("div",fe,[c(m,{label:e.$t("i18nJobDefinition.Detail.frequency"),valueField:"dictionary_value",displayField:"dictionary_name",data:e.dataCombobox.frequency,initText:e.model.frequency_name,onComboboxLoadData:t[4]||(t[4]=l=>e.comboboxLoadData(l,e.dictionaryAPI,e.dataCombobox,"frequency")),buildFilter:e.filterFrequency,queryMode:"remote",remoteFilter:!0,modelValue:e.model.frequency,"onUpdate:modelValue":t[5]||(t[5]=l=>e.model.frequency=l),display:e.model.frequency_name,"onUpdate:display":t[6]||(t[6]=l=>e.model.frequency_name=l)},null,8,["label","data","initText","buildFilter","modelValue","display"]),c(m,{label:e.$t("i18nJobDefinition.Detail.status"),valueField:"dictionary_value",displayField:"dictionary_name",data:e.dataCombobox.status,initText:e.model.status_name,onComboboxLoadData:t[7]||(t[7]=l=>e.comboboxLoadData(l,e.dictionaryAPI,e.dataCombobox,"status")),buildFilter:e.filterStatus,queryMode:"remote",remoteFilter:!0,modelValue:e.model.status,"onUpdate:modelValue":t[8]||(t[8]=l=>e.model.status=l),display:e.model.status_name,"onUpdate:display":t[9]||(t[9]=l=>e.model.status_name=l)},null,8,["label","data","initText","buildFilter","modelValue","display"])])])])],512)]),footer:M(({close:D})=>[r("div",ce,[r("div",pe,[r("div",be,[c(d,{onClick:D},{default:M(()=>[v(g(e.$t("i18nCommon.Close")),1)]),_:2},1032,["onClick"])]),r("div",ke,[c(d,{onClick:e.save,class:"primary"},{default:M(()=>[v(g(e.$t("i18nCommon.crud.save")),1)]),_:1},8,["onClick"])])])])]),_:1},8,["title","onBeforeOpen"])}const ve=T(ie,[["render",ye],["__scopeId","data-v-ba796dc7"]]);export{ve as default};
