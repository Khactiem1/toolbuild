var U=Object.defineProperty;var q=(e,t,u)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[t]=u;var h=(e,t,u)=>q(e,typeof t!="symbol"?t+"":t,u);import{I as W,J as O,g as I,r as C,d as R,e as J,D as V,_ as j,j as w,m as T,o as S,w as f,b as n,k as d,v as $,t as b,p as k}from"./index-DmUMvrSQ.js";import{c as E}from"./crudBaseStore-BQfEd0nr.js";import{n as z}from"./newsListAPI-C72tkElf.js";import{B as M}from"./BaseDetail-zykIlOpR.js";import{M as H}from"./MsFileImage-Dp23ULa6.js";import{M as G}from"./MsFroala-BGFcGW6x.js";import{u as K}from"./remoteCombobox-B8Q4up6i.js";import{d as A}from"./dictionaryAPI-B4HeeuwR.js";import"./validateComponent-kMK-YP6C.js";import"./fileAPI-_RNgakGO.js";import"./popupUtil-BIlfh91z.js";class Q extends W{constructor(){super(...arguments);h(this,"apiName","dictionary");h(this,"controllerName","News")}}const B=new Q,P=new E({field:{key:"news_id",code:""}},B);class X{constructor(){h(this,"state",()=>({...P.state}));h(this,"actions",{...P.actions})}}const Y=new X,Z=O("moduleNews",Y),x=()=>{const{proxy:e}=I(),t=C({TuChoi:{news_status:"TuChoi",news_status_name:""},LuuTam:{news_status:"LuuTam",news_status_name:""},ChoDuyet:{news_status:"ChoDuyet",news_status_name:""},DaDuyet:{news_status:"DaDuyet",news_status_name:""}});return{news_status:t,loadMappingNewStatus:async()=>{var r,y;const p=e,c={PageIndex:0,PageSize:0,Columns:"*",Filter:"",Sort:"",CustomParam:{}};p.editMode==p.$ms.constant.FormState.Add?c.Filter=JSON.stringify([["is_active","=",!0],"and",["dictionary_list_code","=","TrangThaiDuyet"]]):c.Filter=JSON.stringify(["dictionary_list_code","=","TrangThaiDuyet"]),p.$ms.commonFn.mask();const l=await A.getList(c);if(p.$ms.commonFn.unmask(),l!=null&&l.Success&&((y=(r=l==null?void 0:l.Data)==null?void 0:r.PageData)!=null&&y.length)){const m=l.Data.PageData.find(i=>i.dictionary_value==t.value.TuChoi.news_status),_=l.Data.PageData.find(i=>i.dictionary_value==t.value.LuuTam.news_status),v=l.Data.PageData.find(i=>i.dictionary_value==t.value.ChoDuyet.news_status),D=l.Data.PageData.find(i=>i.dictionary_value==t.value.DaDuyet.news_status);m&&(t.value.TuChoi.news_status_name=m.dictionary_name),_&&(t.value.LuuTam.news_status_name=_.dictionary_name),v&&(t.value.ChoDuyet.news_status_name=v.dictionary_name),D&&(t.value.DaDuyet.news_status_name=D.dictionary_name)}}}},ee=R({mixins:[],components:{MsFileImage:H,MsFroala:G},extends:M,setup(){const{proxy:e}=I(),t=Z(),u=C(B),p=C("news"),c=C(!1),l={width:Math.round(window.innerWidth*.8),height:Math.round(window.innerHeight*.8)},{comboboxLoadData:r}=K(),y=J({news_list:[],dictionary:[]}),{news_status:m,loadMappingNewStatus:_}=x(),v=async()=>{const s=e;await _(),s.editMode==s.$ms.constant.FormState.Add&&(s._formParam.dataRow.news_status=m.value.LuuTam.news_status,s._formParam.dataRow.news_status_name=m.value.LuuTam.news_status_name),await s.super("beforeBindData",M)},D=()=>{const s=e;s.editMode==s.$ms.constant.FormState.Add&&(s.model.news_id=s.$ms.commonFn.generateUUID())},i=s=>{const o=e;if(o.editMode==o.$ms.constant.FormState.Add){const L=["is_active","=",!0];o.$ms.commonFn.concatFilter(s,L)}},F=s=>{const o=e;i(s);const L=["dictionary_list_code","=","LoaiTin"];o.$ms.commonFn.concatFilter(s,L)},N=s=>{const o=e;o.model.news_list_name=s.newData?s.newData.news_list_name:null},a=s=>{const o=e;o.model.news_type_name=s.newData?s.newData.dictionary_name:null},g=C(null);return{api:u,stylePopup:l,hideAfterSave:c,news_status:m,storeModule:t,subSystemCode:p,newsListAPI:z,dictionaryAPI:A,dataCombobox:y,afterBindData:D,beforeSave:async s=>{g.value&&(s.news_status=g.value.news_status,s.news_status_name=g.value.news_status_name,g.value=null)},saveWithStatus:s=>{const o=e;g.value=s,o.save()},filterNewType:F,comboboxLoadData:r,filterInactive:i,selectedNewsListList:N,selectedNewsType:a,beforeBindData:v,afterSaveSuccess:async s=>{const o=e;s!=null&&s.Data&&(o.model.news_status=s.Data.news_status,o.model.news_status_name=s.Data.news_status_name)},validateSaveCustom:async s=>{const o=e;if(s.news_status==m.value.DaDuyet.news_status||s.news_status==m.value.ChoDuyet.news_status){if(!s.date_publish)return V(o.$t("i18nValidate.messages.required",{field:o.$t("i18nNews.Detail.date_publish")})),!1;if(!s.news_list_id)return V(o.$t("i18nValidate.messages.required",{field:o.$t("i18nNewsList.Title")})),!1;if(!s.news_type)return V(o.$t("i18nValidate.messages.required",{field:o.$t("i18nNews.Detail.news_type")})),!1;if(!s.picture)return V(o.$t("i18nValidate.messages.required",{field:o.$t("i18nNews.Detail.picture")})),!1}return!0}}}}),te={ref:"slot-content",class:"form-content-popup"},se={class:"form-container pd-t-4"},ae={class:"form-detail flex"},oe={class:"form-item"},ne={class:"form-item_input"},ie={class:"form-group"},le={class:"form-group"},de={class:"form-group"},me={class:"form-item"},ue={class:"form-item_input flex"},re={class:"meta-content",style:{flex:"1"}},we={class:"form-group"},pe={class:"form-group",style:{"padding-left":"0"}},_e={class:"form-group",style:{"padding-left":"0"}},fe={class:"form-group",style:{"padding-left":"0"}},ce={style:{"margin-left":"20px"},class:"select-image"},ye={class:"select-title"},ve={class:"form-detail form-group"},De={class:"form-action"},be={class:"form-action_container"},ge={class:"form-action_item"},he={class:"form-action_item"};function $e(e,t,u,p,c,l){const r=w("ms-input"),y=w("ms-textarea"),m=w("ms-datepicker"),_=w("ms-combobox-v2"),v=w("ms-file-image"),D=w("ms-froala"),i=w("ms-button"),F=w("ms-dynamic-popup");return S(),T(F,{width:e.stylePopup.width,height:e.stylePopup.height,title:`${e.editMode?e.$ms.commonFn.getEnumResource(e.editMode,"FormState"):""} ${e.$t("i18nNews.Title")}`,onBeforeOpen:e.beforeOpen},{content:f(({close:N})=>[n("div",te,[n("div",se,[n("div",ae,[n("div",oe,[n("div",ne,[n("div",ie,[d(r,{maxLength:250,rules:[{name:"required"}],label:e.$t("i18nNews.Detail.news_title"),modelValue:e.model.news_title,"onUpdate:modelValue":t[0]||(t[0]=a=>e.model.news_title=a)},null,8,["label","modelValue"])])]),n("div",le,[d(r,{maxLength:150,label:e.$t("i18nNews.Detail.meta_keyword"),modelValue:e.model.meta_keyword,"onUpdate:modelValue":t[1]||(t[1]=a=>e.model.meta_keyword=a)},null,8,["label","modelValue"])]),n("div",de,[d(y,{maxLength:500,rules:[{name:"required"}],label:e.$t("i18nNews.Detail.news_desc"),modelValue:e.model.news_desc,"onUpdate:modelValue":t[2]||(t[2]=a=>e.model.news_desc=a)},null,8,["label","modelValue"])])]),n("div",me,[n("div",ue,[n("div",re,[n("div",we,[d(m,{label:e.$t("i18nNews.Detail.date_publish"),modelValue:e.model.date_publish,"onUpdate:modelValue":t[3]||(t[3]=a=>e.model.date_publish=a)},null,8,["label","modelValue"])]),n("div",pe,[d(r,{maxLength:250,label:e.$t("i18nNews.Detail.meta_title"),modelValue:e.model.meta_title,"onUpdate:modelValue":t[4]||(t[4]=a=>e.model.meta_title=a)},null,8,["label","modelValue"])]),n("div",_e,[d(_,{label:e.$t("i18nNewsList.Title"),valueField:"news_list_id",displayField:"news_list_name",data:e.dataCombobox.news_list,initText:e.model.news_list_name,onComboboxLoadData:t[5]||(t[5]=a=>e.comboboxLoadData(a,e.newsListAPI,e.dataCombobox,"news_list")),onSelected:e.selectedNewsListList,buildFilter:e.filterInactive,queryMode:"remote",remoteFilter:!0,modelValue:e.model.news_list_id,"onUpdate:modelValue":t[6]||(t[6]=a=>e.model.news_list_id=a),display:e.model.news_list_name,"onUpdate:display":t[7]||(t[7]=a=>e.model.news_list_name=a)},null,8,["label","data","initText","onSelected","buildFilter","modelValue","display"])]),n("div",fe,[d(_,{label:e.$t("i18nNews.Detail.news_type"),valueField:"dictionary_value",displayField:"dictionary_name",data:e.dataCombobox.dictionary,initText:e.model.news_type_name,onComboboxLoadData:t[8]||(t[8]=a=>e.comboboxLoadData(a,e.dictionaryAPI,e.dataCombobox,"dictionary")),onSelected:e.selectedNewsType,buildFilter:e.filterNewType,queryMode:"remote",remoteFilter:!0,modelValue:e.model.news_type,"onUpdate:modelValue":t[9]||(t[9]=a=>e.model.news_type=a),display:e.model.news_type_name,"onUpdate:display":t[10]||(t[10]=a=>e.model.news_type_name=a)},null,8,["label","data","initText","onSelected","buildFilter","modelValue","display"])])]),n("div",ce,[n("label",ye,b(e.$t("i18nNews.Detail.picture"))+" (600px - 330px )",1),d(v,{modelValue:e.model.picture,"onUpdate:modelValue":t[11]||(t[11]=a=>e.model.picture=a),path:"/news/picture"},null,8,["modelValue"])])])])]),n("div",ve,[d(D,{label:e.$t("i18nNews.Detail.content"),modelValue:e.model.content,"onUpdate:modelValue":t[12]||(t[12]=a=>e.model.content=a),pathMedia:`/news/content/${e.model.news_id}`},null,8,["label","modelValue","pathMedia"])])])],512)]),footer:f(({close:N})=>[n("div",De,[n("div",be,[n("div",ge,[d(i,{onClick:N},{default:f(()=>[$(b(e.$t("i18nCommon.Close")),1)]),_:2},1032,["onClick"])]),n("div",he,[d(i,{onClick:t[13]||(t[13]=a=>e.saveWithStatus(e.news_status.LuuTam)),class:"mr-2"},{default:f(()=>[$(b(e.$t("i18nCommon.crud.save")),1)]),_:1}),e.model.news_status==e.news_status.LuuTam.news_status||e.model.news_status==e.news_status.TuChoi.news_status?(S(),T(i,{key:0,onClick:t[14]||(t[14]=a=>e.saveWithStatus(e.news_status.ChoDuyet)),class:"primary mr-2"},{default:f(()=>[$(b(e.$t("i18nNews.Detail.post_news")),1)]),_:1})):k("",!0),e.model.news_status==e.news_status.ChoDuyet.news_status?(S(),T(i,{key:1,onClick:t[15]||(t[15]=a=>e.saveWithStatus(e.news_status.TuChoi)),class:"danger mr-2"},{default:f(()=>[$(b(e.$t("i18nNews.Detail.reject")),1)]),_:1})):k("",!0),e.model.news_status==e.news_status.ChoDuyet.news_status?(S(),T(i,{key:2,onClick:t[16]||(t[16]=a=>e.saveWithStatus(e.news_status.DaDuyet)),class:"primary"},{default:f(()=>[$(b(e.$t("i18nNews.Detail.approved")),1)]),_:1})):k("",!0)])])])]),_:1},8,["width","height","title","onBeforeOpen"])}const Oe=j(ee,[["render",$e],["__scopeId","data-v-470411b1"]]);export{Oe as default};
