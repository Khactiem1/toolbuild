import{m as U,p as N,s as L}from"./crudBaseStore-afhvnkno.js";import{v as R}from"./validateComponent-B7XtBPe1.js";import{cn as C,cx as k,cy as V,cz as G,cA as q,cB as j,a3 as $,cC as H,cD as _,cE as d,cF as F,cG as m,cH as K,cl as W,cI as Y,a4 as J,B as Q}from"./index-whgfsyUy.js";var w=Object.create,X=function(){function e(){}return function(t){if(!C(t))return{};if(w)return w(t);e.prototype=t;var a=new e;return e.prototype=void 0,a}}(),v=function(){try{var e=k(Object,"defineProperty");return e({},"",{}),e}catch{}}();function Z(e,t){for(var a=-1,n=e==null?0:e.length;++a<n&&t(e[a],a,e)!==!1;);return e}function z(e,t,a){t=="__proto__"&&v?v(e,t,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[t]=a}var ee=Object.prototype,te=ee.hasOwnProperty;function ae(e,t,a){var n=e[t];(!(te.call(e,t)&&V(n,a))||a===void 0&&!(t in e))&&z(e,t,a)}var re=G(Object.getPrototypeOf,Object),x=typeof exports=="object"&&exports&&!exports.nodeType&&exports,S=x&&typeof module=="object"&&module&&!module.nodeType&&module,ne=S&&S.exports===x,h=ne?q.Buffer:void 0;h&&h.allocUnsafe;function oe(e,t){return e.slice()}var se=Object.prototype,ce=se.hasOwnProperty;function ie(e){var t=e.length,a=new e.constructor(t);return t&&typeof e[0]=="string"&&ce.call(e,"index")&&(a.index=e.index,a.input=e.input),a}function l(e){var t=new e.constructor(e.byteLength);return new j(t).set(new j(e)),t}function fe(e,t){var a=l(e.buffer);return new e.constructor(a,e.byteOffset,e.byteLength)}var ue=/\w*$/;function me(e){var t=new e.constructor(e.source,ue.exec(e));return t.lastIndex=e.lastIndex,t}var A=$?$.prototype:void 0,D=A?A.valueOf:void 0;function de(e){return D?Object(D.call(e)):{}}function le(e,t){var a=l(e.buffer);return new e.constructor(a,e.byteOffset,e.length)}var pe="[object Boolean]",be="[object Date]",ge="[object Map]",ye="[object Number]",Te="[object RegExp]",je="[object Set]",$e="[object String]",we="[object Symbol]",ve="[object ArrayBuffer]",Se="[object DataView]",he="[object Float32Array]",Ae="[object Float64Array]",De="[object Int8Array]",Me="[object Int16Array]",Oe="[object Int32Array]",Ce="[object Uint8Array]",_e="[object Uint8ClampedArray]",Fe="[object Uint16Array]",xe="[object Uint32Array]";function Ee(e,t,a){var n=e.constructor;switch(t){case ve:return l(e);case pe:case be:return new n(+e);case Se:return fe(e);case he:case Ae:case De:case Me:case Oe:case Ce:case _e:case Fe:case xe:return le(e);case ge:return new n;case ye:case $e:return new n(e);case Te:return me(e);case je:return new n;case we:return de(e)}}function Be(e){return typeof e.constructor=="function"&&!H(e)?X(re(e)):{}}var Pe="[object Map]";function Ie(e){return _(e)&&d(e)==Pe}var M=m&&m.isMap,Ue=M?F(M):Ie,Ne="[object Set]";function Le(e){return _(e)&&d(e)==Ne}var O=m&&m.isSet,Re=O?F(O):Le,E="[object Arguments]",ke="[object Array]",Ve="[object Boolean]",Ge="[object Date]",qe="[object Error]",B="[object Function]",He="[object GeneratorFunction]",Ke="[object Map]",We="[object Number]",P="[object Object]",Ye="[object RegExp]",Je="[object Set]",Qe="[object String]",Xe="[object Symbol]",Ze="[object WeakMap]",ze="[object ArrayBuffer]",et="[object DataView]",tt="[object Float32Array]",at="[object Float64Array]",rt="[object Int8Array]",nt="[object Int16Array]",ot="[object Int32Array]",st="[object Uint8Array]",ct="[object Uint8ClampedArray]",it="[object Uint16Array]",ft="[object Uint32Array]",r={};r[E]=r[ke]=r[ze]=r[et]=r[Ve]=r[Ge]=r[tt]=r[at]=r[rt]=r[nt]=r[ot]=r[Ke]=r[We]=r[P]=r[Ye]=r[Je]=r[Qe]=r[Xe]=r[st]=r[ct]=r[it]=r[ft]=!0;r[qe]=r[B]=r[Ze]=!1;function u(e,t,a,n,p,c){var o;if(o!==void 0)return o;if(!C(e))return e;var b=J(e);if(b)o=ie(e);else{var f=d(e),g=f==B||f==He;if(K(e))return oe(e);if(f==P||f==E||g&&!p)o=g?{}:Be(e);else{if(!r[f])return p?e:{};o=Ee(e,f)}}c||(c=new W);var y=c.get(e);if(y)return y;c.set(e,o),Re(e)?e.forEach(function(s){o.add(u(s,t,a,s,e,c))}):Ue(e)&&e.forEach(function(s,i){o.set(i,u(s,t,a,i,e,c))});var I=Y,T=b?void 0:I(e);return Z(T||e,function(s,i){T&&(i=s,s=e[i]),ae(o,i,u(s,t,a,i,e,c))}),o}var ut=1,mt=4;function dt(e){return u(e,ut|mt)}const gt={mixins:[U,N,R,L],data(){return{viewRef:"viewList",storeModule:{},api:{},editMode:null,model:{},_formParam:{},hideAfterSave:!0}},created(){},mounted(){this.bindData()},beforeUnmount(){},methods:{async beforeBindData(){},async afterBindData(){},async bindData(){var t;const e=this;await e.beforeBindData(),((t=Object.keys(e._formParam.dataRow))==null?void 0:t.length)!==0&&(e.model=e._formParam.dataRow),e.editMode==e.$ms.constant.FormState.Add&&delete e.model[e.storeModule._config.field.key],await e.afterBindData(),setTimeout(()=>{e.$ms.commonFn.focusFirstControl(e.$refs["slot-content"])},100)},beforeOpen(e){const t=this;t._popup=t.$vfm.dynamicModals[t.$vfm.dynamicModals.length-1],t._formParam=e.ref.params._rawValue?e.ref.params._rawValue:e.ref.params,t.editMode=t._formParam.formState},hide(){try{const e=this;e._popup.value=!1,e.$nextTick(()=>{delete e._popup})}catch(e){console.error(e)}},async handleDuplicateDataDelete(){const e=this;if(await Q(e.$t("i18nCommon.AskRestoreDuplicateData"))){e.$ms.commonFn.mask();const a=await e.api.restoreDataDelete(e.model);e.$ms.commonFn.unmask(),a!=null&&a.Success&&(a!=null&&a.Data)&&(e.model[e.storeModule._config.field.key]=a.Data[e.storeModule._config.field.key],e.storeModule.insertItem(e.model),e.editMode=e.$ms.constant.FormState.Edit,e.$ms.commonFn.pushNotification({type:e.$ms.constant.ENotificationType.Success,message:e.$t("i18nCommon.crud.restore_success")}))}},async save(){const e=this,t=dt(e.model);if(await e.beforeSave(t),await e.validateSave(t)){let a=!1,n;switch(e.$ms.commonFn.mask(),e.editMode){case e.$ms.constant.FormState.Add:n=await e.storeModule.insert(t),n!=null&&n.Success?(e.$ms.commonFn.pushNotification({type:e.$ms.constant.ENotificationType.Success,message:e.$t("i18nCommon.crud.save_success")}),a=!0):n.Code==e.$ms.constant.EnumValidateResult.DuplicateDelete&&await e.handleDuplicateDataDelete();break;case e.$ms.constant.FormState.Edit:n=await e.storeModule.update(t),n!=null&&n.Success&&(e.$ms.commonFn.pushNotification({type:e.$ms.constant.ENotificationType.Success,message:e.$t("i18nCommon.crud.edit_success")}),a=!0);break}a&&(await e.afterSaveSuccess(n),e.hideAfterSave&&e.hide()),e.$ms.commonFn.unmask()}},async beforeSave(e){},async afterSaveSuccess(e){},async validateSaveCustom(e){return!0},async validateSave(e){const t=this;return await t.validateComponents()&&await t.validateSaveCustom(e)}}};export{gt as B};
