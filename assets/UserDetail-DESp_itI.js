import{u as R}from"./moduleUser-xyjWHrdb.js";import{d as P,g as B,r as y,G as C,e as M,O as I,_ as A,j as m,m as E,o as D,w as b,b as a,k as d,v as V,t as p,a as k,F as L,l as O}from"./index-whgfsyUy.js";import{B as w}from"./BaseDetail-2bx4aSjb.js";import{M as T}from"./MsFileImage-CUdc8Ebt.js";import{u as G}from"./remoteCombobox-B8Q4up6i.js";import{p as J}from"./positionAPI-DAwv4cW9.js";import{M as j}from"./MsComboboxTreeV2-Dc_yCRuJ.js";import{d as q}from"./departmentAPI-BR-nXrcB.js";import"./crudBaseStore-afhvnkno.js";import"./validateComponent-B7XtBPe1.js";import"./fileAPI-D2rdd4Hc.js";const N=P({mixins:[],components:{MsFileImage:T,MsComboboxTreeV2:j},extends:w,setup(){const{proxy:e}=B(),t=R(),$=y(C),U=y("user"),{comboboxLoadData:h}=G(),f=M({role_code:[],position:[],department_code:[],user:[]}),r=async()=>{var s,n;const l=e;await g(),await l.super("beforeBindData",w),l._formParam.dataRow&&l.editMode==l.$ms.constant.FormState.Add&&(l._formParam.dataRow.gender=l.$ms.constant.Gender.Male),(n=(s=l._formParam.dataRow)==null?void 0:s.UserJoinRoleDetail)!=null&&n.length&&l._formParam.dataRow.UserJoinRoleDetail.forEach(i=>{const o=f.role_code.find(u=>u.role_id==i.role_id);o&&(o.checked=!0)})},_=async l=>{const s=e;l.UserJoinRoleDetail||(l.UserJoinRoleDetail=[]),l.UserJoinRoleDetail.forEach(n=>{n.State=s.$ms.constant.FormState.Delete,n.is_delete_in_database=!0}),f.role_code.forEach(n=>{n.checked&&l.UserJoinRoleDetail.push({State:s.$ms.constant.FormState.Add,role_id:n.role_id})})},g=async()=>{var i,o;const l=e,s={PageIndex:0,PageSize:0,Columns:"*",Filter:"",Sort:"",CustomParam:{}};l.$ms.commonFn.mask();const n=await I.getList(s);l.$ms.commonFn.unmask(),n!=null&&n.Success&&((o=(i=n==null?void 0:n.Data)==null?void 0:i.PageData)!=null&&o.length)&&(f.role_code=n.Data.PageData.sort((u,S)=>S.is_administrator-u.is_administrator))};return{api:$,storeModule:t,subSystemCode:U,comboBoxDataRemote:f,positionAPI:J,userAPI:C,beforeBindData:r,beforeSave:_,filterInactive:l=>{const s=e;if(s.editMode==s.$ms.constant.FormState.Add){const n=["is_active","=",!0];s.$ms.commonFn.concatFilter(l,n)}},selectedDepartment:l=>{const s=e;s.model.department_code=l.newData?l.newData.department_code:null,s.model.department_name=l.newData?l.newData.department_name:null},beforeExpandDepartment:async(l,s={})=>{var u;const n=e;if(l(),n.loadedDataDepartment)return;n.loadedDataDepartment=!0;const i={PageIndex:0,PageSize:0,Columns:"*",Filter:"",Sort:"",CustomParam:{}};s.loading=!0;const o=await q.getList(i);s.loading=!1,o!=null&&o.Success&&((u=o==null?void 0:o.Data)!=null&&u.PageData)&&(f.department_code=o.Data.PageData)},comboboxLoadData:h}}}),z={ref:"slot-content",class:"form-content-popup"},W={class:"form-container mt-4"},H={class:"form-detail flex"},K={class:"form-item"},Q={class:"form-item_input"},X={class:"form-group ms-small"},Y={class:"form-group ms-big"},Z={class:"form-item_input"},x={class:"form-group ms-small"},ee={class:"form-group ms-big"},oe={class:"form-item_input"},te={class:"form-group ms-big"},ae={class:"form-item_input"},le={class:"form-group ms-small"},ne={class:"form-group ms-big"},se={class:"form-item"},de={class:"form-item_input"},ie={class:"form-group ms-small"},me={style:{"padding-left":"16px"},class:"form-group ms-big"},re={class:"ms-radio_item"},ue={class:"form-item_input"},pe={class:"form-group ms-small"},fe={style:{"padding-left":"16px"},class:"form-group ms-big"},be={class:"form-item_input"},_e={class:"form-group ms-big"},ce={class:"form-detail flex form-select-option"},ge={class:"form-item form-detail-role"},ve={class:"select-title"},De={class:"info-checkbox"},Ve={class:"bold"},$e={class:"form-item select-image"},Ue={class:"select-title"},he={class:"form-action"},Fe={class:"form-action_container"},ye={class:"form-action_item"},Ce={class:"form-action_item"};function ke(e,t,$,U,h,f){const r=m("ms-input"),_=m("ms-combobox-v2"),g=m("ms-combobox-tree-v2"),v=m("ms-datepicker"),c=m("ms-radio"),F=m("ms-checkbox"),l=m("ms-file-image"),s=m("ms-button"),n=m("ms-dynamic-popup");return D(),E(n,{width:1e3,height:700,title:`${e.editMode?e.$ms.commonFn.getEnumResource(e.editMode,"FormState"):""} ${e.$t("i18nUser.TitleUser")}`,onBeforeOpen:e.beforeOpen,onShortkeyAction:e.shortkeyAction},{content:b(({close:i})=>[a("div",z,[a("div",W,[a("div",H,[a("div",K,[a("div",Q,[a("div",X,[d(r,{maxLength:30,rules:[{name:"required"}],label:e.$t("i18nUser.Detail.user_name"),modelValue:e.model.user_name,"onUpdate:modelValue":t[0]||(t[0]=o=>e.model.user_name=o)},null,8,["label","modelValue"])]),a("div",Y,[d(r,{maxLength:150,rules:[{name:"required"}],label:e.$t("i18nUser.Detail.user_full_name"),modelValue:e.model.user_full_name,"onUpdate:modelValue":t[1]||(t[1]=o=>e.model.user_full_name=o)},null,8,["label","modelValue"])])]),a("div",Z,[a("div",x,[d(r,{maxLength:15,label:e.$t("i18nUser.Detail.user_code"),modelValue:e.model.user_code,"onUpdate:modelValue":t[2]||(t[2]=o=>e.model.user_code=o)},null,8,["label","modelValue"])]),a("div",ee,[d(_,{label:e.$t("i18nUser.Detail.manager"),valueField:"user_id",displayField:"user_full_name",data:e.comboBoxDataRemote.user,initText:e.model.manager_name,onComboboxLoadData:t[3]||(t[3]=o=>e.comboboxLoadData(o,e.userAPI,e.comboBoxDataRemote,"user")),buildFilter:e.filterInactive,queryMode:"remote",remoteFilter:!0,modelValue:e.model.manager,"onUpdate:modelValue":t[4]||(t[4]=o=>e.model.manager=o),display:e.model.manager_name,"onUpdate:display":t[5]||(t[5]=o=>e.model.manager_name=o),dropdownWidth:730,columns:[{title:e.$t("i18nUser.Detail.user_name"),dataField:"user_name",width:160,filterOperator:e.$ms.constant.FilterOperator.Contains},{title:e.$t("i18nUser.Detail.user_full_name"),dataField:"user_full_name",width:200,filterOperator:e.$ms.constant.FilterOperator.Contains},{title:e.$t("i18nUser.Detail.phone_number"),dataField:"phone_number",width:140,filterOperator:e.$ms.constant.FilterOperator.Contains},{title:e.$t("i18nUser.Detail.email"),dataField:"email",width:220,filterOperator:e.$ms.constant.FilterOperator.Contains}]},null,8,["label","data","initText","buildFilter","modelValue","display","columns"])])]),a("div",oe,[a("div",te,[d(g,{label:e.$t("i18nUser.Detail.department_name"),data:e.comboBoxDataRemote.department_code,modelValue:e.model.department_id,"onUpdate:modelValue":t[6]||(t[6]=o=>e.model.department_id=o),display:e.model.department_name,"onUpdate:display":t[7]||(t[7]=o=>e.model.department_name=o),initText:e.model.department_name,valueField:"department_id",displayField:"department_name",idProperty:"department_id",isAsyncBeforeExpand:!0,onBeforeExpand:e.beforeExpandDepartment,onSelected:e.selectedDepartment,dropdownWidth:500,columns:[{title:e.$t("i18nDepartment.Detail.department_code"),dataField:"department_code",width:240},{title:e.$t("i18nDepartment.Detail.department_name"),dataField:"department_name",width:260}]},null,8,["label","data","modelValue","display","initText","onBeforeExpand","onSelected","columns"])])]),a("div",ae,[a("div",le,[d(r,{maxLength:13,rules:[{name:"pattern",compareValue:"phone"}],label:e.$t("i18nUser.Detail.phone_number"),modelValue:e.model.phone_number,"onUpdate:modelValue":t[8]||(t[8]=o=>e.model.phone_number=o)},null,8,["label","modelValue"])]),a("div",ne,[d(r,{maxLength:50,rules:[{name:"pattern",compareValue:"email"}],label:e.$t("i18nUser.Detail.email"),modelValue:e.model.email,"onUpdate:modelValue":t[9]||(t[9]=o=>e.model.email=o)},null,8,["label","modelValue"])])])]),a("div",se,[a("div",de,[a("div",ie,[d(v,{label:e.$t("i18nUser.Detail.date_of_birth"),max:new Date,modelValue:e.model.date_of_birth,"onUpdate:modelValue":t[10]||(t[10]=o=>e.model.date_of_birth=o)},null,8,["label","max","modelValue"])]),a("div",me,[a("label",null,p(e.$t("i18nUser.Detail.gender")),1),a("div",re,[d(c,{label:e.$t("i18nEnum.Gender.Male"),value:e.$ms.constant.Gender.Male,modelValue:e.model.gender,"onUpdate:modelValue":t[11]||(t[11]=o=>e.model.gender=o),modelModifiers:{number:!0}},null,8,["label","value","modelValue"]),d(c,{label:e.$t("i18nEnum.Gender.Female"),value:e.$ms.constant.Gender.Female,modelValue:e.model.gender,"onUpdate:modelValue":t[12]||(t[12]=o=>e.model.gender=o),modelModifiers:{number:!0}},null,8,["label","value","modelValue"]),d(c,{label:e.$t("i18nEnum.Gender.Other"),value:e.$ms.constant.Gender.Other,modelValue:e.model.gender,"onUpdate:modelValue":t[13]||(t[13]=o=>e.model.gender=o),modelModifiers:{number:!0}},null,8,["label","value","modelValue"])])])]),a("div",ue,[a("div",pe,[d(v,{label:e.$t("i18nUser.Detail.date_joining"),modelValue:e.model.date_joining,"onUpdate:modelValue":t[14]||(t[14]=o=>e.model.date_joining=o)},null,8,["label","modelValue"])]),a("div",fe,[d(_,{label:e.$t("i18nUser.Detail.position_name"),valueField:"position_id",displayField:"position_name",data:e.comboBoxDataRemote.position,initText:e.model.position_name,onComboboxLoadData:t[15]||(t[15]=o=>e.comboboxLoadData(o,e.positionAPI,e.comboBoxDataRemote,"position")),buildFilter:e.filterInactive,queryMode:"remote",remoteFilter:!0,modelValue:e.model.position_id,"onUpdate:modelValue":t[16]||(t[16]=o=>e.model.position_id=o),display:e.model.position_name,"onUpdate:display":t[17]||(t[17]=o=>e.model.position_name=o)},null,8,["label","data","initText","buildFilter","modelValue","display"])])]),a("div",be,[a("div",_e,[d(r,{maxLength:255,label:e.$t("i18nUser.Detail.address"),modelValue:e.model.address,"onUpdate:modelValue":t[18]||(t[18]=o=>e.model.address=o)},null,8,["label","modelValue"])])])])]),a("div",ce,[a("div",ge,[a("label",ve,p(e.$t("i18nRole.SelectRole")),1),(D(!0),k(L,null,O(e.comboBoxDataRemote.role_code,o=>(D(),k("div",{class:"role-item",key:o.role_id},[d(F,{modelValue:o.checked,"onUpdate:modelValue":u=>o.checked=u},{default:b(()=>[a("div",De,[a("span",Ve,p(o.role_code),1),V(": "+p(o.role_name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))]),a("div",$e,[a("label",Ue,p(e.$t("i18nUser.Detail.avartar"))+" (300px - 300px)",1),d(l,{modelValue:e.model.avartar,"onUpdate:modelValue":t[19]||(t[19]=o=>e.model.avartar=o),path:"/user/avatar"},null,8,["modelValue"])])])])],512)]),footer:b(({close:i})=>[a("div",he,[a("div",Fe,[a("div",ye,[d(s,{onClick:i},{default:b(()=>[V(p(e.$t("i18nCommon.Close")),1)]),_:2},1032,["onClick"])]),a("div",Ce,[d(s,{onClick:e.save,class:"primary","shortkey-target":"Save",title:"Ctrl + s"},{default:b(()=>[V(p(e.$t("i18nCommon.crud.save")),1)]),_:1},8,["onClick"])])])])]),_:1},8,["title","onBeforeOpen","onShortkeyAction"])}const Te=A(N,[["render",ke],["__scopeId","data-v-4183d0f9"]]);export{Te as default};
