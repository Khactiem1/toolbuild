var U=Object.defineProperty;var q=(e,t,r)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var C=(e,t,r)=>q(e,typeof t!="symbol"?t+"":t,r);import{I as W,J as O,g as I,r as h,d as R,e as J,D as T,_ as j,j as f,m as S,o as V,w as c,b as n,k as u,v as $,t as b,p as F}from"./index-whgfsyUy.js";import{c as E}from"./crudBaseStore-afhvnkno.js";import{n as z}from"./newsListAPI-CHbexthL.js";import{B as k}from"./BaseDetail-2bx4aSjb.js";import{M as H}from"./MsFileImage-CUdc8Ebt.js";import{u as G}from"./remoteCombobox-B8Q4up6i.js";import{d as M}from"./dictionaryAPI-CC-qEnNc.js";import"./validateComponent-B7XtBPe1.js";import"./fileAPI-D2rdd4Hc.js";class K extends W{constructor(){super(...arguments);C(this,"apiName","dictionary");C(this,"controllerName","News")}}const A=new K,P=new E({field:{key:"news_id",code:""}},A);class Q{constructor(){C(this,"state",()=>({...P.state}));C(this,"actions",{...P.actions})}}const X=new Q,Y=O("moduleNews",X),Z=()=>{const{proxy:e}=I(),t=h({TuChoi:{news_status:"TuChoi",news_status_name:""},LuuTam:{news_status:"LuuTam",news_status_name:""},ChoDuyet:{news_status:"ChoDuyet",news_status_name:""},DaDuyet:{news_status:"DaDuyet",news_status_name:""}});return{news_status:t,loadMappingNewStatus:async()=>{var w,v;const p=e,y={PageIndex:0,PageSize:0,Columns:"*",Filter:"",Sort:"",CustomParam:{}};p.editMode==p.$ms.constant.FormState.Add?y.Filter=JSON.stringify([["is_active","=",!0],"and",["dictionary_list_code","=","TrangThaiDuyet"]]):y.Filter=JSON.stringify(["dictionary_list_code","=","TrangThaiDuyet"]),p.$ms.commonFn.mask();const i=await M.getList(y);if(p.$ms.commonFn.unmask(),i!=null&&i.Success&&((v=(w=i==null?void 0:i.Data)==null?void 0:w.PageData)!=null&&v.length)){const d=i.Data.PageData.find(l=>l.dictionary_value==t.value.TuChoi.news_status),_=i.Data.PageData.find(l=>l.dictionary_value==t.value.LuuTam.news_status),D=i.Data.PageData.find(l=>l.dictionary_value==t.value.ChoDuyet.news_status),m=i.Data.PageData.find(l=>l.dictionary_value==t.value.DaDuyet.news_status);d&&(t.value.TuChoi.news_status_name=d.dictionary_name),_&&(t.value.LuuTam.news_status_name=_.dictionary_name),D&&(t.value.ChoDuyet.news_status_name=D.dictionary_name),m&&(t.value.DaDuyet.news_status_name=m.dictionary_name)}}}},x=R({mixins:[],components:{MsFileImage:H},extends:k,setup(){const{proxy:e}=I(),t=Y(),r=h(A),p=h("news"),y=h(!1),i={width:Math.round(window.innerWidth*.8),height:Math.round(window.innerHeight*.8)},{comboboxLoadData:w}=G(),v=J({news_list:[],dictionary:[]}),{news_status:d,loadMappingNewStatus:_}=Z(),D=async()=>{const s=e;await _(),s.editMode==s.$ms.constant.FormState.Add&&(s._formParam.dataRow.news_status=d.value.LuuTam.news_status,s._formParam.dataRow.news_status_name=d.value.LuuTam.news_status_name),await s.super("beforeBindData",k)},m=()=>{const s=e;s.editMode==s.$ms.constant.FormState.Add&&(s.model.news_id=s.$ms.commonFn.generateUUID())},l=s=>{const o=e;if(o.editMode==o.$ms.constant.FormState.Add){const L=["is_active","=",!0];o.$ms.commonFn.concatFilter(s,L)}},N=s=>{const o=e;l(s);const L=["dictionary_list_code","=","LoaiTin"];o.$ms.commonFn.concatFilter(s,L)},a=s=>{const o=e;o.model.news_list_name=s.newData?s.newData.news_list_name:null},B=s=>{const o=e;o.model.news_type_name=s.newData?s.newData.dictionary_name:null},g=h(null);return{api:r,stylePopup:i,hideAfterSave:y,news_status:d,storeModule:t,subSystemCode:p,newsListAPI:z,dictionaryAPI:M,dataCombobox:v,afterBindData:m,beforeSave:async s=>{g.value&&(s.news_status=g.value.news_status,s.news_status_name=g.value.news_status_name,g.value=null)},saveWithStatus:s=>{const o=e;g.value=s,o.save()},filterNewType:N,comboboxLoadData:w,filterInactive:l,selectedNewsListList:a,selectedNewsType:B,beforeBindData:D,afterSaveSuccess:async s=>{const o=e;s!=null&&s.Data&&(o.model.news_status=s.Data.news_status,o.model.news_status_name=s.Data.news_status_name)},validateSaveCustom:async s=>{const o=e;if(s.news_status==d.value.DaDuyet.news_status||s.news_status==d.value.ChoDuyet.news_status){if(!s.date_publish)return T(o.$t("i18nValidate.messages.required",{field:o.$t("i18nNews.Detail.date_publish")})),!1;if(!s.news_list_id)return T(o.$t("i18nValidate.messages.required",{field:o.$t("i18nNewsList.Title")})),!1;if(!s.news_type)return T(o.$t("i18nValidate.messages.required",{field:o.$t("i18nNews.Detail.news_type")})),!1;if(!s.picture)return T(o.$t("i18nValidate.messages.required",{field:o.$t("i18nNews.Detail.picture")})),!1}return!0}}}}),ee={ref:"slot-content",class:"form-content-popup"},te={class:"form-container pd-t-4"},se={class:"form-detail flex"},ae={class:"form-item"},oe={class:"form-item_input"},ne={class:"form-group"},ie={class:"form-group"},le={class:"form-group"},de={class:"form-item"},me={class:"form-item_input flex"},ue={class:"meta-content",style:{flex:"1"}},re={class:"form-group"},we={class:"form-group",style:{"padding-left":"0"}},pe={class:"form-group",style:{"padding-left":"0"}},_e={class:"form-group",style:{"padding-left":"0"}},fe={style:{"margin-left":"20px"},class:"select-image"},ce={class:"select-title"},ye={class:"form-action"},ve={class:"form-action_container"},De={class:"form-action_item"},be={class:"form-action_item"};function ge(e,t,r,p,y,i){const w=f("ms-input"),v=f("ms-textarea"),d=f("ms-datepicker"),_=f("ms-combobox-v2"),D=f("ms-file-image"),m=f("ms-button"),l=f("ms-dynamic-popup");return V(),S(l,{width:e.stylePopup.width,height:e.stylePopup.height,title:`${e.editMode?e.$ms.commonFn.getEnumResource(e.editMode,"FormState"):""} ${e.$t("i18nNews.Title")}`,onBeforeOpen:e.beforeOpen},{content:c(({close:N})=>[n("div",ee,[n("div",te,[n("div",se,[n("div",ae,[n("div",oe,[n("div",ne,[u(w,{maxLength:250,rules:[{name:"required"}],label:e.$t("i18nNews.Detail.news_title"),modelValue:e.model.news_title,"onUpdate:modelValue":t[0]||(t[0]=a=>e.model.news_title=a)},null,8,["label","modelValue"])])]),n("div",ie,[u(w,{maxLength:150,label:e.$t("i18nNews.Detail.meta_keyword"),modelValue:e.model.meta_keyword,"onUpdate:modelValue":t[1]||(t[1]=a=>e.model.meta_keyword=a)},null,8,["label","modelValue"])]),n("div",le,[u(v,{maxLength:500,rules:[{name:"required"}],label:e.$t("i18nNews.Detail.news_desc"),modelValue:e.model.news_desc,"onUpdate:modelValue":t[2]||(t[2]=a=>e.model.news_desc=a)},null,8,["label","modelValue"])])]),n("div",de,[n("div",me,[n("div",ue,[n("div",re,[u(d,{label:e.$t("i18nNews.Detail.date_publish"),modelValue:e.model.date_publish,"onUpdate:modelValue":t[3]||(t[3]=a=>e.model.date_publish=a)},null,8,["label","modelValue"])]),n("div",we,[u(w,{maxLength:250,label:e.$t("i18nNews.Detail.meta_title"),modelValue:e.model.meta_title,"onUpdate:modelValue":t[4]||(t[4]=a=>e.model.meta_title=a)},null,8,["label","modelValue"])]),n("div",pe,[u(_,{label:e.$t("i18nNewsList.Title"),valueField:"news_list_id",displayField:"news_list_name",data:e.dataCombobox.news_list,initText:e.model.news_list_name,onComboboxLoadData:t[5]||(t[5]=a=>e.comboboxLoadData(a,e.newsListAPI,e.dataCombobox,"news_list")),onSelected:e.selectedNewsListList,buildFilter:e.filterInactive,queryMode:"remote",remoteFilter:!0,modelValue:e.model.news_list_id,"onUpdate:modelValue":t[6]||(t[6]=a=>e.model.news_list_id=a),display:e.model.news_list_name,"onUpdate:display":t[7]||(t[7]=a=>e.model.news_list_name=a)},null,8,["label","data","initText","onSelected","buildFilter","modelValue","display"])]),n("div",_e,[u(_,{label:e.$t("i18nNews.Detail.news_type"),valueField:"dictionary_value",displayField:"dictionary_name",data:e.dataCombobox.dictionary,initText:e.model.news_type_name,onComboboxLoadData:t[8]||(t[8]=a=>e.comboboxLoadData(a,e.dictionaryAPI,e.dataCombobox,"dictionary")),onSelected:e.selectedNewsType,buildFilter:e.filterNewType,queryMode:"remote",remoteFilter:!0,modelValue:e.model.news_type,"onUpdate:modelValue":t[9]||(t[9]=a=>e.model.news_type=a),display:e.model.news_type_name,"onUpdate:display":t[10]||(t[10]=a=>e.model.news_type_name=a)},null,8,["label","data","initText","onSelected","buildFilter","modelValue","display"])])]),n("div",fe,[n("label",ce,b(e.$t("i18nNews.Detail.picture"))+" (600px - 330px )",1),u(D,{modelValue:e.model.picture,"onUpdate:modelValue":t[11]||(t[11]=a=>e.model.picture=a),path:"/news/picture"},null,8,["modelValue"])])])])]),t[16]||(t[16]=n("div",{class:"form-detail form-group"},null,-1))])],512)]),footer:c(({close:N})=>[n("div",ye,[n("div",ve,[n("div",De,[u(m,{onClick:N},{default:c(()=>[$(b(e.$t("i18nCommon.Close")),1)]),_:2},1032,["onClick"])]),n("div",be,[u(m,{onClick:t[12]||(t[12]=a=>e.saveWithStatus(e.news_status.LuuTam)),class:"mr-2"},{default:c(()=>[$(b(e.$t("i18nCommon.crud.save")),1)]),_:1}),e.model.news_status==e.news_status.LuuTam.news_status||e.model.news_status==e.news_status.TuChoi.news_status?(V(),S(m,{key:0,onClick:t[13]||(t[13]=a=>e.saveWithStatus(e.news_status.ChoDuyet)),class:"primary mr-2"},{default:c(()=>[$(b(e.$t("i18nNews.Detail.post_news")),1)]),_:1})):F("",!0),e.model.news_status==e.news_status.ChoDuyet.news_status?(V(),S(m,{key:1,onClick:t[14]||(t[14]=a=>e.saveWithStatus(e.news_status.TuChoi)),class:"danger mr-2"},{default:c(()=>[$(b(e.$t("i18nNews.Detail.reject")),1)]),_:1})):F("",!0),e.model.news_status==e.news_status.ChoDuyet.news_status?(V(),S(m,{key:2,onClick:t[15]||(t[15]=a=>e.saveWithStatus(e.news_status.DaDuyet)),class:"primary"},{default:c(()=>[$(b(e.$t("i18nNews.Detail.approved")),1)]),_:1})):F("",!0)])])])]),_:1},8,["width","height","title","onBeforeOpen"])}const Be=j(x,[["render",ge],["__scopeId","data-v-f400260c"]]);export{Be as default};
