var g=Object.defineProperty;var y=(n,i,r)=>i in n?g(n,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[i]=r;var c=(n,i,r)=>y(n,typeof i!="symbol"?i+"":i,r);import{a3 as u,a4 as f,a5 as k,a6 as d,D as p,a7 as b,Z as m,a8 as S}from"./index-whgfsyUy.js";function D(n,i){var r=-1,s=n.length;for(i||(i=Array(s));++r<s;)i[r]=n[r];return i}var h=u?u.isConcatSpreadable:void 0;function x(n){return f(n)||k(n)||!!(h&&n&&n[h])}function A(n,i,r,s,t){var e=-1,a=n.length;for(r||(r=x),t||(t=[]);++e<a;){var o=n[e];r(o)?d(t,o):t[t.length]=o}return t}function w(){var n=arguments.length;if(!n)return[];for(var i=Array(n-1),r=arguments[0],s=n;s--;)i[s-1]=arguments[s];return d(f(r)?D(r):[r],A(i))}const P={created(){},methods:{super(n,i){const r=this;let s=i;for(let e=0;e<10;e++){let a=s.methods[n];if(typeof a=="function"){let o=[];for(var t=2;t<arguments.length;t++)o.push(arguments[t]);return a.apply(r,o)}if(!s.extends)break;s=s.extends}return null}}},I={data(){return{subSystemCode:null}},methods:{checkActionPermission(n,i=null){return i||(i=this.subSystemCode),b.checkActionPermissonNotAsync(n,i)},checkActionPermissionAlert(n,i=null){const r=this,s=r.checkActionPermission(n,i);if(!s){const t=r.$t("i18nCommon.notPermission");throw p(t),t}return s}}},F={props:{},data:function(){return{statusBarText:null}},methods:{shortkeyAction(n){let i=this;switch(n.originEvent.which){case 120:case 27:break;default:i.executeShortkey(n);break}},executeShortkey(n){if(n.originEvent.cancel)return;let i=this;const r=n.target.getAttribute("shortkey");if(r&&r.split("|").indexOf(n.srcKey)>-1){n.originEvent.preventDefault(),n.originEvent.stopPropagation(),n.originEvent.cancel=!0,document.body.click();var s=['[shortkey-target="',n.srcKey,'"]'].join(""),t=i.$el.querySelector(s);if(t)if(t.classList.contains("split-button")){let e=t.querySelector("button");e&&e.click()}else t.click()}}}};class L{constructor(i,r){c(this,"state",{});c(this,"actions",{});this.state={total:0,items:[],loading:!1,_config:i},this.actions={updateLoading(s){const t=this;t.loading=s},async load(s){const t=this;let e={};try{t.updateLoading(!0),e=await r.getList(s||{}),e&&e.Data&&(t.items=e.Data.PageData,t.total=e.Data.Count)}finally{t.updateLoading(!1)}return e.Data},async insert(s){const t=this;let e=await r.insert(s);if(e&&e.Success)t.insertItem(e.Data);else if(e.Data.length){let a=e.Data.filter(o=>o.Code==S.DuplicateDelete);if(a!=null&&a.length)return a[0];m.handleErrorValidateResult(e.Data)}return e},async update(s){const t=this;let e=await r.update(s,s[i.field.key]);return e&&e.Success?t.updateItem(e.Data):m.handleErrorValidateResult(e.Data),e},insertItem(s){const t=this;let e=s;t.items=w(e,t.items),t.total+=1,t.empty=!1},updateItem(s){const t=this;let e=t._config.field.key;if(e){let a=s[e];for(let o=0;o<t.items.length;o++){let l=t.items[o];if(l[e]===a){Object.assign(l,s);break}}}},async delete(s){const t=this;let e=t._config.field.key;if(e){s={id:s[e]};let a=await r.delete(s);if(a&&a.Success){let o=t.items.findIndex(l=>l[e]==s.id);o!==-1&&(t.items.splice(o,1),t.total-=1)}return a}}}}}export{L as c,P as m,I as p,F as s};
