import{M as de,a as ue,b as ce,c as me}from"./MsGridFilter-BBAgkP7-.js";import{d as fe}from"./vuedraggable.umd-Dc4WJ5c4.js";import{d as oe,g as ae,r as P,c as ie,s as pe,h as he,Q as W,R as K,S as ge,M as Q,T as se,_ as ne,j as T,V as ye,a as g,o as p,b as y,p as C,m as H,k as E,w as $e,q as X,n as D,t as k,H as Z,F as j,l as Y,N as ee,W as ke,Y as ve,v as O,a2 as G,B as te}from"./index-whgfsyUy.js";import{u as Fe}from"./resizeColumn-rjPeOVu3.js";import{m as Ce,p as we,s as Se}from"./crudBaseStore-afhvnkno.js";import{p as U}from"./popupUtil-BcxEQbku.js";import{l as be}from"./layoutAPI-CCTRduX6.js";const Te=oe({components:{MsPagination:me,MsGridEmpty:ce,MsGridLoader:ue,MsGridFilter:de,draggable:fe},props:{data:{type:Array,default:[]},serial:{type:Boolean,default:!0},pageTotal:{type:Number,default:0},gridInfo:{type:Object,default:{selected:[],pageSize:50,pageIndex:1}},columns:{type:Array,default:[]},loading:{type:Boolean,default:!1},showAction:{type:Boolean,default:!0},idField:{type:String,default:""},multiple:{type:Boolean,default:!0},filterable:{type:Boolean,default:!0},pagination:{type:Boolean,default:!0},loadData:{type:Function,default:()=>{}}},setup(){const{proxy:e}=ae(),t=P({}),{resizeOn:a,resizeOff:n,handleShowFilter:u}=Fe(),l=P(""),d=o=>{const i=e,r=i.gridInfo.selected.findIndex(m=>m[i.idField]==o[i.idField]);r!==-1?i.gridInfo.selected.splice(r,1):i.gridInfo.selected.push(o)},F=o=>{const i=e;return i.gridInfo.selected&&i.gridInfo.selected.length>0?i.gridInfo.selected.findIndex(r=>r[i.idField]===o[i.idField])!==-1:!1},S=ie(()=>{const o=e;if(o.idField&&o.multiple&&o.data&&o.gridInfo.selected){const i=o.data.map(m=>m[o.idField]),r=o.gridInfo.selected.filter(m=>i.includes(m[o.idField]));return!!(r!=null&&r.length&&r.length===i.length)}}),R=()=>{const o=e;o.gridInfo.selected=[]},M=()=>{const o=e;S.value?o.data.forEach(i=>{const r=o.gridInfo.selected.findIndex(m=>m[o.idField]==i[o.idField]);r!==-1&&o.gridInfo.selected.splice(r,1)}):o.data.forEach(i=>{o.gridInfo.selected.find(r=>r[o.idField]==i[o.idField])||o.gridInfo.selected.push(i)})},I=P(!1),w=P([]);pe(()=>{let o=localStorage.getItem("lineClamp");o||o==""?l.value=o:l.value="hidden-space_1"}),he(()=>{var i;const o=e;(i=o.columns)!=null&&i.length&&L(o.columns),W.$on(K.updateTheSettingClamp,A)}),ge(()=>{W.$off(K.updateTheSettingClamp,A)});const A=o=>{o||o==""?l.value=o:l.value="hidden-space_1"};Q(I,o=>{o===!1&&e.$nextTick(()=>{L(w.value)})});const L=o=>{e.serial&&!o.find(r=>r.type=="serial")&&o.unshift({lock:!0,width:60,header:"i18nCommon.serial",type:"serial",formatType:12,visible:!0}),w.value=o.sort((r,m)=>m.lock-r.lock),_()},_=()=>{const o=e;let i=16;o.multiple&&(i=i+40),w.value.forEach(r=>{r.offset=i,i+=Number(r.width)})},s=o=>{e.$emit("handleDoubleClickRow",o)},N=o=>{e.data.forEach(r=>{delete r.selected}),o.selected=!0},h=async o=>{const i=e;i.gridInfo.pageIndex=1,i.gridInfo.pageSize=o,localStorage.setItem("pageSize",`${o}`),i.loadData()},V=o=>{const i=e;i.gridInfo.pageIndex=o,i.loadData()},B=P(e.gridInfo.pageSize);Q(B,o=>{h(o)});const J=P(!1),le=P({top:0,left:0});return{colFilter:t,currentPage:B,columnx:w,dragging:I,isCheckedAll:S,isShowFilter:J,setPositionFilter:le,lineClamp:l,resizeOn:a,resizeOff:n,updateStickyOffset:_,isSelected:F,loadPageIndex:V,handleSetSortColumn:async o=>{const i=e;o.type!="serial"&&(o.sort?o.sort=="DESC"?o.sort="ASC":delete o.sort:o.sort="DESC",i.loadData())},handleShowFilter:u,buildSortFilter:()=>{let o=e,i=[];return o.columnx.filter(m=>m.sort).forEach(m=>{i.push(`${m.dataField} ${m.sort}`)}),i.join(",")},getFilterHeader:(o=!1)=>{let i=e,r=[],m=i.$ms.constant.FilterOperator,q=i.columnx.filter(x=>x.filter);for(let x=0;x<q.length;x++){let f=q[x];if(f.filter&&f.filter.value!==f.filterIgnoreValue){let c=null,v=f.filter.value,z=f.filter.operator;switch(v&&typeof v=="string"&&(v=v.replaceAll("\\","\\\\\\\\").replaceAll("%","\\%").trim()),z){case m.Between:c=[{field:f.dataField,operator:m.GreaterThanEquals,value:f.filter.from},{field:f.dataField,operator:m.LessThanEquals,value:f.filter.to}];break;case m.Null:case m.NotNull:switch(c={field:f.dataField,operator:z},f.formatType){case i.$ms.constant.FormatType.Text:c.value="text";break}break;case m.Contains:case m.Notcontains:case m.StartsWith:case m.EndsWith:typeof v<"u"&&v!==null&&v!==""&&(c={field:f.dataField,operator:z,value:v});break;default:switch(f.formatType){case i.$ms.constant.FormatType.Date:case i.$ms.constant.FormatType.DateTime:v&&(c={field:f.dataField,value:se(v).format("YYYY-MM-DDTHH:mm:ss"),operator:z});break;default:typeof v<"u"&&v!==null&&(c={field:f.dataField,value:v,operator:z});break}break}if(c&&(f.enumName||f.enum)&&!Array.isArray(c)){let $=i.$ms.constant[f.enumName||f.enum],b=!1;for(let re in $)if($[re]===c.value){b=!0;break}b||(c=null)}if(c)if(Array.isArray(c))for(let $=0;$<c.length;$++){const b=c[$];o&&(b.column=f),f.nullToFail&&(b.nullToFail=f.nullToFail),r.length>0&&r.push("and"),r.push([b.field,b.operator,b.value])}else if(o&&(c.column=f),f.nullToFail&&(c.nullToFail=f.nullToFail),r.length>0&&r.push("and"),f.formatType==i.$ms.constant.FormatType.Text)if(c.operator==m.Null){let $=[];$.push([c.field,c.operator,c.value]),$.push("or"),$.push([c.field,"=",""]),r.push($)}else if(c.operator==m.NotNull){let $=[];$.push([c.field,c.operator,c.value]),$.push("and"),$.push([c.field,"<>",""]),r.push($)}else r.push([c.field,c.operator,c.value]);else r.push([c.field,c.operator,c.value])}}return i.customFilter&&(Array.isArray(i.customFilter)&&(r=r.concat(i.customFilter)),typeof i.customFilter=="function"&&(r=i.customFilter(r))),r},changeCheckedMultiple:M,handleClickCheckbox:d,initColumns:L,handleFixColumn:o=>{o.lock=!o.lock,J.value=!1,L(w.value)},handleDoubleClickRow:s,handleClickRow:N,removeSelectedAll:R}}}),Ie={class:"ms-grid-viewer table-content"},Pe={class:"table-scroll"},De={class:"table-container"},Re={class:"table"},Me={class:"thead-light"},Le={key:0,class:"fix",style:{width:"40px"}},Ne=["onClick"],Ee={style:{flex:"1",display:"inline-block"}},Ae=["onClick"],_e=["onMouseup","onMousedown"],xe={key:1,style:{width:"120px","min-width":"120px"},class:"text-center fix column-end"},ze={key:2},Ve=["onDblclick","onClick"],Be={key:0,class:"column-sticky"},He=["title"],Oe={key:2,class:"data-table-bind",style:{display:"flex","justify-content":"center"}},Ge={key:1,class:"text-center fix column-end"},Ue={class:"action-colum_table"},je={key:0,class:"paging-container sticky"},Ye={class:"total-record"},Je={key:0},qe={style:{color:"var(--primary__color)"}},We={style:{padding:"0 4px"}},Ke={style:{color:"var(--primary__color)"}},Qe={key:0,class:"paging"};function Xe(e,t,a,n,u,l){var _;const d=T("ms-checkbox"),F=T("draggable"),S=T("ms-grid-loader"),R=T("ms-grid-empty"),M=T("ms-switch"),I=T("ms-grid-filter"),w=T("ms-combobox"),A=T("ms-pagination"),L=ye("click-outside");return p(),g("div",Ie,[y("div",Pe,[y("div",De,[y("table",Re,[y("thead",Me,[y("tr",null,[e.multiple?(p(),g("th",Le,[E(d,{checked:e.isCheckedAll,onCustomHandleClickCheckbox:e.changeCheckedMultiple},null,8,["checked","onCustomHandleClickCheckbox"])])):C("",!0),E(F,{list:e.columnx,disabled:!1,"item-key":"dataField",tag:"div",class:"drag","ghost-class":"ghost",onStart:t[0]||(t[0]=s=>e.dragging=!0),onEnd:t[1]||(t[1]=s=>e.dragging=!1)},{item:$e(({element:s,index:N})=>[y("th",{class:D(`
                      ${N===e.columnx.length-1?"header-content-end":""}
                      ${s.formatType===e.$ms.constant.FormatType.Number?"right":""}
                      ${s.lock?"z3":""}
                    `),style:X({"min-width":`${s.width?s.width:150}px`,width:`${s.width}px`,"max-width":`${s.width}px`,position:`${s.lock?"sticky":""}`,left:`${s.lock?`${s.offset}px`:""}`})},[y("span",{style:{display:"flex","line-height":"18px"},class:D(""),onClick:h=>e.handleSetSortColumn(s)},[y("span",Ee,k(s.headerCustom&&s.headerCustom.trim()!==""?s.headerCustom:s.header?e.$t(`${s.header}`):s.header),1),s.sort?(p(),g("div",{key:0,class:D(["sort",{sortASC:s.sort==="ASC"}])},null,2)):C("",!0)],8,Ne),e.filterable&&s.type!="serial"?(p(),g("div",{key:0,onClick:h=>e.handleShowFilter(h,s),class:"mi-header-option"},null,8,Ae)):C("",!0),y("div",{class:"ms-resize",onMouseup:Z(h=>{e.resizeOff(h,s)},["stop","prevent"]),onMousedown:Z(h=>{e.resizeOn(h,s)},["stop","prevent"])},null,40,_e)],6)]),_:1},8,["list"]),e.showAction?(p(),g("th",xe,k(e.$t("i18nCommon.function")),1)):C("",!0)])]),e.loading?(p(),H(S,{key:0,columns:e.columnx,lengthList:e.data.length>20?20:e.data.length},null,8,["columns","lengthList"])):!e.loading&&e.data.length===0?(p(),H(R,{key:1})):(p(),g("tbody",ze,[(p(!0),g(j,null,Y(e.data,(s,N)=>(p(),g("tr",{key:e.idField?s[e.idField]:N,onDblclick:h=>e.handleDoubleClickRow(s),onClick:h=>e.handleClickRow(s),class:D([`${s.selected?"row-selected":""}`])},[e.multiple?(p(),g("td",Be,[E(d,{checked:e.isSelected(s),onCustomHandleClickCheckbox:h=>e.handleClickCheckbox(s)},null,8,["checked","onCustomHandleClickCheckbox"])])):C("",!0),(p(!0),g(j,null,Y(e.columnx,(h,V)=>(p(),g("td",{title:e.$ms.commonFn.processDataaGridViewer(h,s[h.dataField]),class:D(`
                  ${V===e.columnx.length-1?"header-content-end":""}
                  ${h.formatType===e.$ms.constant.FormatType.Number?"right":""}
                  ${h.lock?"z3":""}
                `),key:V,style:X({position:`${h.lock?"sticky":""}`,left:`${h.lock?`${h.offset}px`:""}`})},[h.type==="custom"?ee(e.$slots,h.dataField,{key:0,record:s},void 0,!0):h.type=="serial"?(p(),g("span",{key:1,class:D(["data-table-bind",`${e.lineClamp}`]),style:{"text-align":"center"}},k((e.gridInfo.pageIndex-1)*e.gridInfo.pageSize+(N+1)),3)):h.dataField=="is_active"?(p(),g("div",Oe,[E(M,{disabled:!0,modelValue:s.is_active,"onUpdate:modelValue":B=>s.is_active=B},null,8,["modelValue","onUpdate:modelValue"])])):(p(),g("span",{key:3,class:D(["data-table-bind",`${e.lineClamp}`])},k(e.$ms.commonFn.processDataaGridViewer(h,s[h.dataField])),3))],14,He))),128)),e.showAction?(p(),g("td",Ge,[y("div",Ue,[ee(e.$slots,"widget-body",{record:s},void 0,!0)])])):C("",!0)],42,Ve))),128))])),(p(),H(ve,{to:"#app"},[e.isShowFilter?ke((p(),H(I,{key:0,onHandleFixColumn:e.handleFixColumn,handleShowFilter:e.handleShowFilter,col:e.colFilter,setPositionFilter:e.setPositionFilter},null,8,["onHandleFixColumn","handleShowFilter","col","setPositionFilter"])),[[L,()=>e.handleShowFilter()]]):C("",!0)]))])])]),e.data.length!==0&&e.pageTotal?(p(),g("div",je,[y("div",Ye,[O(k(e.$t("i18nCommon.total"))+" ",1),y("strong",null,k(e.pageTotal),1),O(" "+k(e.$t("i18nCommon.record"))+" ",1),e.multiple&&((_=e.gridInfo.selected)!=null&&_.length)?(p(),g("span",Je,[t[4]||(t[4]=O(" - ")),y("span",qe,k(e.$t("i18nControl.MsGridViewer.selected")),1),y("strong",We,k(e.gridInfo.selected.length),1),y("span",Ke,k(e.$t("i18nCommon.record")),1),t[5]||(t[5]=O(" - ")),y("span",{onClick:t[2]||(t[2]=(...s)=>e.removeSelectedAll&&e.removeSelectedAll(...s)),class:"remove-selected-all"},k(e.$t("i18nControl.MsGridViewer.removeSelectedAll")),1)])):C("",!0)]),e.pagination?(p(),g("div",Qe,[E(w,{data:[{value:10,header:e.$t("i18nEnum.Pagination.Ten")},{value:20,header:e.$t("i18nEnum.Pagination.Twen")},{value:30,header:e.$t("i18nEnum.Pagination.Thir")},{value:50,header:e.$t("i18nEnum.Pagination.Fif")},{value:100,header:e.$t("i18nEnum.Pagination.Hunder")}],disabled:!0,value:"value",header:"header",noAnimation:!0,autoPosition:!0,modelValue:e.currentPage,"onUpdate:modelValue":t[3]||(t[3]=s=>e.currentPage=s)},null,8,["data","modelValue"]),E(A,{pageSize:e.gridInfo.pageSize,pageTotal:e.pageTotal,pageIndex:e.gridInfo.pageIndex,onLoadPageIndex:e.loadPageIndex},null,8,["pageSize","pageTotal","pageIndex","onLoadPageIndex"])])):C("",!0)])):C("",!0)])}const pt=ne(Te,[["render",Xe],["__scopeId","data-v-4fb22d31"]]),Ze=oe({props:{grid:{type:Object,default:{}}},setup(e){const{proxy:t}=ae();return{dataBindFilter:ie(()=>{var l,d;const u=t;return(d=(l=u.grid)==null?void 0:l.columnx)!=null&&d.length?u.grid.columnx.filter(S=>S.filter):[]}),handleDeleteFilterItem:(u=null)=>{const l=t;u?u.filter=null:l.grid.columnx.filter(F=>F.filter).forEach(F=>{F.filter=null}),l.$emit("loadData")}}}}),et={class:"form-key-search"},tt=["onClick"];function ot(e,t,a,n,u,l){return p(),g("div",et,[(p(!0),g(j,null,Y(e.dataBindFilter,(d,F)=>{var S,R,M,I,w;return p(),g("div",{class:"filter-item",key:F},[y("span",null,k(d.headerCustom&&d.headerCustom.trim()!==""?d.headerCustom:e.$t(d.header))+" "+k((R=(S=d.filter)==null?void 0:S.comparisonType)==null?void 0:R.enumText)+k(((M=d.filter)==null?void 0:M.value)!=null&&((I=d.filter)==null?void 0:I.value)!=null?`: ${e.$ms.commonFn.processDataaGridViewer(d,(w=d.filter)==null?void 0:w.value)}`:""),1),y("div",{onClick:A=>e.handleDeleteFilterItem(d),class:"delete-filter-icon"},null,8,tt)])}),128)),e.dataBindFilter.length>0?(p(),g("div",{key:0,onClick:t[0]||(t[0]=d=>e.handleDeleteFilterItem()),class:"filter-item delete-filter-item"},[y("span",null,k(e.$t("i18nControl.MsGridViewer.remove_search")),1)])):C("",!0)])}const ht=ne(Ze,[["render",ot],["__scopeId","data-v-16c1a8a8"]]),gt={mixins:[Ce,we,Se],data(){return{storeModule:{},api:{},viewRef:"viewList",searchText:"",condition:{},filterable:!0,lstRenderCondition:[],filterParam:{},gridInfo:{selected:[],pageSize:50,pageIndex:1},timeoutId:0,layoutTag:"",formDetailName:"",isLoadActiveColumn:!0,defaultShortKeyList:{AddNew:["alt","n"]}}},created(){const e=this,t=localStorage.getItem("pageSize");t&&(e.gridInfo.pageSize=Number(t))},async mounted(){const e=this;e.$ms.commonFn.shortkeyPushView(e.$el),await e.initLayout(),e.$nextTick(()=>{})},beforeUnmount(){},unmounted(){const e=this;e.$ms.commonFn.shortkeyPopView(e.$el)},methods:{async initLayout(e=null){const t=this;e!=null&&e.length||(e=await t.getLayoutTemplate()),e!=null&&e.length&&(e=e.filter(a=>a.visible),await t.customLayout(e),t.applyLayout(e))},async loadData(){const e=this;let t={PageIndex:1,PageSize:50,Columns:"",Filter:"",Sort:"",CustomParam:{}};await e.processParamLoadData(t),await e.customParamLoadData(t),await e.storeModule.load(t)},async customParamLoadData(e){},async processParamLoadData(e){var a,n,u,l;const t=this;t.$refs[t.viewRef]&&((a=t.$refs[t.viewRef].columnx)!=null&&a.length)&&(e.Columns=t.$refs[t.viewRef].columnx.map(d=>d.dataField).filter(d=>d).join(",")),(l=(u=(n=t.storeModule)==null?void 0:n._config)==null?void 0:u.field)!=null&&l.key&&(e.Columns?e.Columns=e.Columns.concat(`,${t.storeModule._config.field.key}`):e.Columns=e.Columns.concat(`${t.storeModule._config.field.key}`)),t.addColActiveParam(e),e.PageSize=t.gridInfo.pageSize,e.PageIndex=t.gridInfo.pageIndex,e.Filter=t.buildFilterParam(),e.Sort=t.buildSortFilter()},addColActiveParam(e){const t=this;if(!e.Columns)return;!e.Columns.split(",").includes("is_active")&&t.isLoadActiveColumn&&(e.Columns=e.Columns.concat(",is_active"))},buildSortFilter(){const e=this;if(e.$refs[e.viewRef]&&typeof e.$refs[e.viewRef].buildSortFilter=="function"){const t=e.$refs[e.viewRef].buildSortFilter();if(t)return t}return""},debounceSearch(e,t){const a=this;clearTimeout(a.timeoutId),a.timeoutId=setTimeout(()=>{var n;typeof((n=a.$refs[a.viewRef])==null?void 0:n.loadPageIndex)=="function"&&a.$refs[a.viewRef].loadPageIndex(1)},500)},buildCustomFilter(){var n;const e=this;let t=[],a=e.searchText?e.searchText.trim():e.searchText;return e.$refs[e.viewRef]&&((n=e.$refs[e.viewRef].columnx)!=null&&n.length)&&a&&e.$refs[e.viewRef].columnx.forEach(u=>{if(u.dataField)switch(u.formatType){case e.$ms.constant.FormatType.Text:t.length>0&&t.push("or"),t.push([u.dataField,"contains",a]);break}}),t},buildFilterParam(){const e=this,t=e.buildCustomFilter();if(e.$refs[e.viewRef]&&typeof e.$refs[e.viewRef].getFilterHeader=="function"){const a=e.$refs[e.viewRef].getFilterHeader();if(a&&a.length)return t!=null&&t.length&&(a.push("and"),a.push(t)),JSON.stringify(a)}return t!=null&&t.length?JSON.stringify(t):""},async applyLayout(e){const t=this;t.$refs[t.viewRef]&&typeof t.$refs[t.viewRef].initColumns=="function"&&t.$refs[t.viewRef].initColumns(e)},async customLayout(e){},async getLayoutTemplate(){var t;const e=this;if(e.layoutTag){let a=G.get(`Layout${e.layoutTag}`);if(a)return a;let n=await be.getLayoutByTag(e.layoutTag);if((t=n==null?void 0:n.Data)!=null&&t.config)return a=JSON.parse(n.Data.config),G.set(`Layout${e.layoutTag}`,a),G.set(`Layout${e.layoutTag}Edit`,JSON.parse(JSON.stringify(a))),a}return null},async toggleActive(e,t){const a=this,n=e.map(d=>d[a.storeModule._config.field.key]);let u={ListID:n,Inactive:t};a.$ms.commonFn.mask();let l=await a.api.inactive(u);a.$ms.commonFn.unmask(),l!=null&&l.Success&&a.storeModule.items.forEach(d=>{n.includes(d[a.storeModule._config.field.key])&&(d.is_active=t)})},async deleteRow(e){var n;const t=this;if(await te(t.$t("i18nCommon.AskDeleteRecord"))){t.$ms.commonFn.mask();let u=await t.storeModule.delete(e);t.$ms.commonFn.unmask(),u!=null&&u.Success&&(t.storeModule.items.length||typeof((n=t.$refs[t.viewRef])==null?void 0:n.loadPageIndex)=="function"&&t.$refs[t.viewRef].loadPageIndex(1),t.$ms.commonFn.pushNotification({type:t.$ms.constant.ENotificationType.Success,message:t.$t("i18nCommon.crud.delete_success")}))}},async deleteMultiple(){var a;const e=this;if(await te(e.$t("i18nCommon.AskDeleteRecord"))){const n=e.gridInfo.selected.map(l=>l[e.storeModule._config.field.key]);e.$ms.commonFn.mask();let u=await e.api.deleteMultiple(n);e.$ms.commonFn.unmask(),u!=null&&u.Success&&(n.forEach(l=>{let d=e.storeModule.items.findIndex(F=>F[e.storeModule._config.field.key]===l);d!==-1&&(e.storeModule.items.splice(d,1),e.storeModule.total-=1)}),e.gridInfo.selected=[],e.storeModule.items.length||typeof((a=e.$refs[e.viewRef])==null?void 0:a.loadPageIndex)=="function"&&e.$refs[e.viewRef].loadPageIndex(1),e.$ms.commonFn.pushNotification({type:e.$ms.constant.ENotificationType.Success,message:e.$t("i18nCommon.crud.delete_success")}))}},async edit(e){const t=this;if(t.subSystemCode&&!t.checkActionPermission("Edit"))return;t.$ms.commonFn.mask();let a={id:e[t.storeModule._config.field.key]},n=await t.api.getEdit(a);if(t.$ms.commonFn.unmask(),n!=null&&n.Success){let u={formState:t.$ms.constant.FormState.Edit,dataRow:n.Data};U.show(t.formDetailName,u)}},async duplicate(e){const t=this;t.$ms.commonFn.mask();let a={id:e[t.storeModule._config.field.key]},n=await t.api.getEdit(a);if(t.$ms.commonFn.unmask(),n!=null&&n.Success){let u={formState:t.$ms.constant.FormState.Add,dataRow:n.Data};U.show(t.formDetailName,u)}},async add(){const e=this;let t={formState:e.$ms.constant.FormState.Add,dataRow:{}};U.show(e.formDetailName,t)},configLayout(){const e=this;let t=G.get(`Layout${e.layoutTag}Edit`);if(t!=null&&t.length){let a={columns:JSON.parse(JSON.stringify(t)),layoutTag:e.layoutTag,initLayout:async n=>{await e.initLayout(n),e.$nextTick(()=>{e.loadData()})}};U.show("MsConfigLayoutList",a)}},async exportData(){var n;const e=this;let t={SheetName:"",Title:"",HeaderColumns:[],Param:{PageIndex:0,PageSize:0,Columns:"",Filter:"",Sort:"",CustomParam:{}}};await e.processParamLoadData(t.Param),await e.customParamLoadData(t.Param),t.Param.PageIndex=0,t.Param.PageSize=0;let a=e.$el.querySelector(".name-table.text-uppercase h1");if(a!=null&&a.innerText&&(t.Title=a.innerText,t.SheetName=a.innerText),e.$refs[e.viewRef]&&typeof((n=e.$refs[e.viewRef].columnx)==null?void 0:n.length)){e.$refs[e.viewRef].columnx.forEach(l=>{l.dataField&&t.HeaderColumns.push({DataField:l.dataField,FormatType:Number(l.formatType),Header:l.headerCustom&&l.headerCustom.trim()!==""?l.headerCustom:e.$t(l.header),Width:l.width?Number(l.width):180,EnumResources:l.formatType==e.$ms.constant.FormatType.Enum?e.$ms.commonFn.getEnumSource(l.enum):null})}),e.$ms.commonFn.mask();let u=await e.api.exportData(t);if(e.$ms.commonFn.unmask(),u){const l=window.URL.createObjectURL(u),d=document.createElement("a");d.href=l,d.download=`${t.SheetName}_${se(new Date).format("DD/MM/YYYY")}.xlsx`,d.click(),window.URL.revokeObjectURL(l)}}}}};export{gt as B,ht as L,pt as M};
