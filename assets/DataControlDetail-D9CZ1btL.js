var E=Object.defineProperty;var j=(e,o,i)=>o in e?E(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i;var _=(e,o,i)=>j(e,typeof o!="symbol"?o+"":o,i);import{B as U,L as q,M as K}from"./BaseList-BRQHvThi.js";import{I as W,a1 as w,J as z,d as G,g as J,r as M,T as u,e as Q,B as N,_ as X,j as v,m as Z,o as D,w as T,b as l,k as h,v as S,t as p,a as b,p as Y,n as P}from"./index-whgfsyUy.js";import{c as x}from"./crudBaseStore-afhvnkno.js";import"./MsGridFilter-BBAgkP7-.js";import"./vuedraggable.umd-Dc4WJ5c4.js";import"./resizeColumn-rjPeOVu3.js";import"./popupUtil-BcxEQbku.js";import"./layoutAPI-CCTRduX6.js";class ee extends W{constructor(){super(...arguments);_(this,"apiName","dictionary");_(this,"controllerName","DataControl")}getRecordByTableName(i){let n={url:[this.getAPIUrl(),"get-info-table"].join("/"),data:i};return w.postAsync(n)}deleteDataControl(i){let n={url:[this.getAPIUrl(),"delete-data-control"].join("/"),data:i};return w.postAsync(n,!0)}restoreData(i){let n={url:[this.getAPIUrl(),"restore-data-control"].join("/"),data:i};return w.postAsync(n,!0)}deleteDataControlBySchema(i){let n={url:[this.getAPIUrl(),"delete-data-control-by-schema-name"].join("/"),data:i};return w.postAsync(n,!0)}restoreDataBySchema(i){let n={url:[this.getAPIUrl(),"restore-data-control-by-schema-name"].join("/"),data:i};return w.postAsync(n,!0)}}const C=new ee,V=new x({field:{key:"column_name",code:""}},C);class te{constructor(){_(this,"state",()=>({...V.state}));_(this,"actions",{...V.actions,async deleteDataControl(o){const i=this;let n=i._config.field.key;if(n){let c=await C.deleteDataControl([o]);if(c&&c.Success){let f=i.items.findIndex(d=>d[n]==o[n]);f!==-1&&(i.items.splice(f,1),i.total-=1)}return c}},async restoreData(o){const i=this;let n=i._config.field.key;if(n){let c=await C.restoreData([o]);if(c&&c.Success){let f=i.items.findIndex(d=>d[n]==o[n]);f!==-1&&(i.items.splice(f,1),i.total-=1)}return c}}})}}const oe=new te,ae=z("moduleDataControlDetail",oe),se=G({components:{MsGridViewer:K,ListConditionFilter:q},extends:U,setup(){const{proxy:e}=J(),o=ae(),i=M(C),n=M(""),c=M("monitoring_del_data"),f=M({all:{fromDate:u("1972-01-01").startOf("day").format("YYYY-MM-DDTHH:mm:ss"),toDate:u("2100-12-31").endOf("day").format("YYYY-MM-DDTHH:mm:ss")},today:{fromDate:u().startOf("day").format("YYYY-MM-DDTHH:mm:ss"),toDate:u().endOf("day").format("YYYY-MM-DDTHH:mm:ss")},thisWeek:{fromDate:u().startOf("week").format("YYYY-MM-DDTHH:mm:ss"),toDate:u().endOf("week").format("YYYY-MM-DDTHH:mm:ss")},thisMonth:{fromDate:u().startOf("month").format("YYYY-MM-DDTHH:mm:ss"),toDate:u().endOf("month").format("YYYY-MM-DDTHH:mm:ss")},thisYear:{fromDate:u().startOf("year").format("YYYY-MM-DDTHH:mm:ss"),toDate:u().endOf("year").format("YYYY-MM-DDTHH:mm:ss")}}),d=M({...f.value.all,type:"all"}),g=Q([]),A=async(a,t)=>{var r;const s=e;d.value.type!=t&&(d.value={...a,type:t},s.storeModule.items=[],typeof((r=s.$refs[s.viewRef])==null?void 0:r.loadPageIndex)=="function"&&s.$refs[s.viewRef].loadPageIndex(1))},I=a=>{var s;const t=e;t._popup=t.$vfm.dynamicModals[t.$vfm.dynamicModals.length-1],t._formParam=a.ref.params._rawValue?a.ref.params._rawValue:a.ref.params,(s=t._formParam)!=null&&s.infoTable&&(t._formParam.typeActive&&(d.value={...f.value[t._formParam.typeActive.type],type:t._formParam.typeActive.type}),R(t._formParam.infoTable))},R=a=>{const t=e;a.length&&(a.forEach(s=>{s.data_type=="uuid"&&s.is_primary_key&&(n.value=s.column_name,t.storeModule._config.field.key=n.value);const r={lock:!1,width:300,header:"",dataField:s.column_name,formatType:null,headerCustom:s.column_name,visible:!0,enum:null};switch(s.data_type){case"character varying":r.formatType=12;break;case"timestamp without time zone":case"date":r.formatType=14;break;case"boolean":r.formatType=100,r.enum="EnumYesNo";break;case"numeric":case"decimal":case"double":case"integer":r.formatType=20;break}r.dataField=="is_active"?(r.formatType=100,r.enum="EnumInactive"):r.dataField=="deleted_date"&&(r.lock=!0),g.push(r)}),t.$refs[t.viewRef]&&typeof t.$refs[t.viewRef].initColumns=="function"&&t.$refs[t.viewRef].initColumns(g))};return{api:i,idField:n,columns:g,storeModule:o,filterDate:f,typeActive:d,subSystemCode:c,handleFilterType:A,beforeOpen:I,deleteMultiple:async a=>{var r;const t=e;if(await N(t.$t(a=="delete"?"i18nCommon.AskDeleteRecord":"i18nCommon.AskRestoreRecord"))){const k=t.gridInfo.selected.map(y=>y[t.storeModule._config.field.key]);t.$ms.commonFn.mask();let m=null;const $=k.map(y=>({schema_name:t._formParam.dataRow.schema_name,table_name:t._formParam.dataRow.table_name,ColumnKey:n.value,ValueKey:y,[n.value]:y}));a=="delete"?m=await C.deleteDataControl($):m=await C.restoreData($),t.$ms.commonFn.unmask(),m!=null&&m.Success&&(k.forEach(y=>{let O=t.storeModule.items.findIndex(L=>L[t.storeModule._config.field.key]===y);O!==-1&&(t.storeModule.items.splice(O,1),t.storeModule.total-=1)}),t.gridInfo.selected=[],t.storeModule.items.length||typeof((r=t.$refs[t.viewRef])==null?void 0:r.loadPageIndex)=="function"&&t.$refs[t.viewRef].loadPageIndex(1),t.$ms.commonFn.pushNotification({type:t.$ms.constant.ENotificationType.Success,message:t.$t(a=="delete"?"i18nCommon.crud.delete_success":"i18nCommon.crud.restore_success")}))}},deleteRow:async(a,t)=>{var k;const s=e;if(await N(s.$t(t=="delete"?"i18nCommon.AskDeleteRecord":"i18nCommon.AskRestoreRecord"))){s.$ms.commonFn.mask();let m=null;const $={schema_name:s._formParam.dataRow.schema_name,table_name:s._formParam.dataRow.table_name,ColumnKey:n.value,ValueKey:a[n.value],[n.value]:a[n.value]};t=="delete"?m=await s.storeModule.deleteDataControl($):m=await s.storeModule.restoreData($),s.$ms.commonFn.unmask(),m!=null&&m.Success&&(s.storeModule.items.length||typeof((k=s.$refs[s.viewRef])==null?void 0:k.loadPageIndex)=="function"&&s.$refs[s.viewRef].loadPageIndex(1),s.$ms.commonFn.pushNotification({type:s.$ms.constant.ENotificationType.Success,message:s.$t(t=="delete"?"i18nCommon.crud.delete_success":"i18nCommon.crud.restore_success")}))}},customParamLoadData:async a=>{const t=e,s=[["deleted_date",">=",d.value.fromDate],"and",["deleted_date","<=",d.value.toDate]];a.CustomParam||(a.CustomParam={}),a.CustomParam.ViewName=`"${t._formParam.dataRow.schema_name}".${t._formParam.dataRow.table_name}`,a.CustomParam.isPagingDetail=!0,a.CustomParam.columnKey=n.value,t.$ms.commonFn.concatFilter(a,s),a.Columns="*"}}}}),ne={ref:"slot-content",class:"form-content-popup"},ie={class:"form-container"},le={class:"table-function sticky"},re={class:"form-fix"},de={class:"action-left flex"},me={style:{"margin-right":"8px"},class:"table-function_series toggle-list"},ce={key:0,class:"table-list_action"},fe={style:{width:"320px"}},ue={style:{"min-width":"320px"},class:"table-function_search"},pe=["title"],ye={style:{"padding-top":"0","z-index":"5"},class:"table-function"},ve={class:"flex badge-container"},De={class:"widget-container"},he=["onClick","title"],Ce={class:"action-default pr-1 danger-color"},ge=["title","onClick"],ke={class:"form-action"},$e={class:"form-action_container"},_e={class:"form-action_item"};function we(e,o,i,n,c,f){const d=v("font-awesome-icon"),g=v("ms-input"),A=v("list-condition-filter"),I=v("ms-grid-viewer"),R=v("ms-button"),B=v("ms-dynamic-popup");return D(),Z(B,{maximum:!0,title:e.$t("i18nDataControl.Title"),onBeforeOpen:e.beforeOpen},{content:T(({close:F})=>{var H;return[l("div",ne,[l("div",ie,[l("div",le,[l("div",re,[l("div",de,[l("button",me,[l("span",null,p(e.$t("i18nCommon.batch_execution")),1),o[10]||(o[10]=l("div",{class:"table-function_series-icon"},null,-1)),(H=e.gridInfo.selected)!=null&&H.length?(D(),b("div",ce,[e.checkActionPermission("Delete")?(D(),b("div",{key:0,class:"list_action-item",onClick:o[0]||(o[0]=a=>e.deleteMultiple("delete"))},[h(d,{icon:["fas","trash"],class:"mr-2"}),S(" "+p(e.$t("i18nEnum.ModelState.Delete")),1)])):Y("",!0),e.checkActionPermission("Edit")?(D(),b("div",{key:1,class:"list_action-item",onClick:o[1]||(o[1]=a=>e.deleteMultiple("restore"))},[o[9]||(o[9]=l("i",{class:"fa fa-refresh mr-2","aria-hidden":"true"},null,-1)),S(" "+p(e.$t("i18nCommon.crud.restore")),1)])):Y("",!0)])):Y("",!0)]),l("div",fe,[h(g,{onInput:e.debounceSearch,modelValue:e.searchText,"onUpdate:modelValue":o[2]||(o[2]=a=>e.searchText=a),placeholder:e.$t("i18nCommon.search")},null,8,["onInput","modelValue","placeholder"])])]),h(A,{grid:e.$refs[e.viewRef],onLoadData:e.loadData},null,8,["grid","onLoadData"])]),l("div",ue,[l("div",{class:"action-render_table reload-table",onClick:o[3]||(o[3]=(...a)=>e.loadData&&e.loadData(...a)),title:e.$t("i18nCommon.load_data")},null,8,pe)])]),l("div",ye,[l("div",ve,[l("div",{onClick:o[4]||(o[4]=a=>e.handleFilterType(e.filterDate.all,"all")),class:P(["badge",{active:e.typeActive.type=="all"}])},p(e.$t("i18nDataControl.List.All")),3),l("div",{onClick:o[5]||(o[5]=a=>e.handleFilterType(e.filterDate.today,"today")),class:P(["badge",{active:e.typeActive.type=="today"}])},p(e.$t("i18nDataControl.List.Today")),3),l("div",{onClick:o[6]||(o[6]=a=>e.handleFilterType(e.filterDate.thisWeek,"thisWeek")),class:P(["badge",{active:e.typeActive.type=="thisWeek"}])},p(e.$t("i18nDataControl.List.ThisWeek")),3),l("div",{onClick:o[7]||(o[7]=a=>e.handleFilterType(e.filterDate.thisMonth,"thisMonth")),class:P(["badge",{active:e.typeActive.type=="thisMonth"}])},p(e.$t("i18nDataControl.List.ThisMonth")),3),l("div",{onClick:o[8]||(o[8]=a=>e.handleFilterType(e.filterDate.thisYear,"thisYear")),class:P(["badge",{active:e.typeActive.type=="thisYear"}])},p(e.$t("i18nDataControl.List.thisYear")),3)])]),h(I,{ref:e.viewRef,columns:e.columns,data:e.storeModule.items,pageTotal:e.storeModule.total,loading:e.storeModule.loading,idField:e.idField,gridInfo:e.gridInfo,loadData:e.loadData},{"widget-body":T(({record:a})=>[l("div",De,[e.checkActionPermission("Delete")?(D(),b("button",{key:0,onClick:t=>e.deleteRow(a,"delete"),title:e.$t("i18nEnum.ModelState.Delete"),class:"action-table action-table_left"},[l("div",Ce,[h(d,{icon:["fas","trash"],class:"mr-2"})])],8,he)):Y("",!0),e.checkActionPermission("Edit")?(D(),b("button",{key:1,title:e.$t("i18nCommon.crud.restore"),onClick:t=>e.deleteRow(a,"restore"),class:"action-table action-table_left primary-color"},o[11]||(o[11]=[l("i",{class:"fa fa-refresh","aria-hidden":"true"},null,-1)]),8,ge)):Y("",!0)])]),_:1},8,["columns","data","pageTotal","loading","idField","gridInfo","loadData"])])],512)]}),footer:T(({close:F})=>[l("div",ke,[l("div",$e,[o[12]||(o[12]=l("div",{class:"form-action_item"},null,-1)),l("div",_e,[h(R,{onClick:F},{default:T(()=>[S(p(e.$t("i18nCommon.Close")),1)]),_:2},1032,["onClick"])])])])]),_:1},8,["title","onBeforeOpen"])}const He=X(se,[["render",we],["__scopeId","data-v-7d38e6bd"]]);export{He as default};
