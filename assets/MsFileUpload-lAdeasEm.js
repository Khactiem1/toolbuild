import{_ as O,r as S,g as I,c as L,K as N,a as f,o as p,p as D,b as s,t as g,q as T,n as b,H as C,v as B,F as E,l as j,E as w}from"./index-DmUMvrSQ.js";import{f as M}from"./fileAPI-_RNgakGO.js";const A={name:"msFileUpload",props:{modelValue:{type:String,default:null},textSize:{type:Number,default:13},text:{type:String,default(){const{t:c}=N();return c("i18nCommon.MsFileUpload.Attachment")}},maxSize:{type:Number,default:5},allowExt:{type:Array,default:["doc","docx","xls","xlsx","pdf","xml","zip","mp4","ppt","pptx","xmind","jpg","jpeg","png"]},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},showModeView:{type:Boolean,default:!0},idComponent:{type:String,default:"fileUploadComponent"},path:{required:!1,default:""}},watch:{modelValue:{immediate:!0,handler(c){c?this.listFile.length==0&&this.listFile.append(JSON.parse(c)):this.listFile=[]}}},emits:["update:modelValue","onError","onSuccess"],setup(c,{emit:n}){let r=S([]);const{proxy:e}=I(),v=S(!1),h=(t,l=2)=>{if(t===0)return"0 bytes";const i=1024,a=l<0?0:l,d=["bytes","kb","mb","gb","tb","pb","eb","zb","yb"],m=Math.floor(Math.log(t)/Math.log(i));return(parseFloat((t/Math.pow(i,m)).toFixed(a))+d[m]).toString()},o=async(t,l=-1)=>{if(k(t))n("onSuccess",t.currentTarget.files);else{n("onError");let m=e.$refs.fileInput;m&&(m.value=null);return}let a=[...t.target.files];l==-1?await z("all",a):await z(l,a);let d=e.$refs.fileInput;d&&(d.value=null)},u=(t,l)=>{e.listFile.splice(l,1),n("update:modelValue",JSON.stringify(e.listFile))},y=async t=>{let l=M.getFileViewUrl(t.FileID);e.$ms.commonFn.downloadLink(l)},z=async(t,l)=>{const i=e;v.value=!0,i.$ms.commonFn.mask();const a=await M.uploadFile(l[0],i.path);if(i.$ms.commonFn.unmask(),v.value=!1,a!=null&&a.Success&&(a!=null&&a.Data)){let d={FileID:a.Data,FileName:l[0].name,FileSize:l[0].size,FileType:a.Data.split(".")[1],UploadDate:a.ServeTime};l&&l.length?e.listFile.splice(t,0,d):l&&l.length&&e.listFile.push(d),n("update:modelValue",JSON.stringify(e.listFile))}},k=t=>{var a;const l=t.currentTarget.files;let i=!0;if(l&&l.length>0){if(!e.multiple&&(l.length>1||(a=e.listFile)!=null&&a.length))return i=!1,w(e.$t("i18nCommon.MsFileUpload.ValidateSelectMultipleFile")),i;for(let d=0;d<l.length;d++){const m=l[d];let x="";if(m&&(_(m.size)?V(m)||(i=!1,x=e.$t("i18nCommon.MsFileUpload.ValidateFileType",{fileType:e.allowExt.join(", ")})):(i=!1,x=e.$t("i18nCommon.MsFileUpload.FileOverSizeMsg"))),!i){w(x);break}}}return i},V=t=>{const l=e,{name:i}=t;if(i){let a=i.split(".").pop();if(a&&(a=a.toLocaleLowerCase()),l.allowExt.some(d=>d.toLocaleLowerCase()===a))return!0}},_=t=>{const i=e.maxSize*1048576;if(t<i)return!0},U=L(()=>e.maxSize?e.$t("i18nCommon.MsFileUpload.MaxFileSize").replace("#fileSize#",e.maxSize):""),F=S(!1);return{isDragOver:F,onDragOver:t=>{t.preventDefault(),F.value=!0},onDragLeave:()=>{F.value=!1},onDrop:t=>{var l,i;t.preventDefault(),F.value=!1,t.currentTarget.files=(l=t.dataTransfer)==null?void 0:l.files,t.target.files=(i=t.dataTransfer)==null?void 0:i.files,o(t)},listFile:r,formatSize:h,onChange:o,deleteFile:u,downloadFile:y,maxSizeLabel:U,isUploading:v}}},J={key:0,class:"flex flex-row label-gap items-center mb-2"},q={class:"title-upload-expand"},H={class:"flex-row"},P=["id","multiple"],K=["for"],W={class:"flex-column control-gap flex-wrap file-items"},G={class:"file-item"},Q=["onClick"],R=["title"],X=["onClick"];function Y(c,n,r,e,v,h){return p(),f("div",null,[r.text?(p(),f("div",J,[s("div",{class:"title-upload semi-bold",style:T(`font-size: ${r.textSize}px`)},g(r.text),5),s("div",q,"Â  "+g(e.maxSizeLabel),1)])):D("",!0),s("div",{class:b(["ms-file-upload flex-column control-gap",r.disabled?"disabled":""])},[r.showModeView?(p(),f("div",{key:0,class:b(r.disabled?"disabled-event":"")},[s("div",H,[(p(),f("input",{type:"file",key:r.modelValue,onChange:n[0]||(n[0]=(...o)=>e.onChange&&e.onChange(...o)),class:"input-upload",id:r.idComponent,multiple:r.multiple,ref:"fileInput"},null,40,P)),s("label",{class:b(["btn-upload-file cursor-pointer",[{isDragOver:e.isDragOver}]]),onDragover:n[1]||(n[1]=C((...o)=>e.onDragOver&&e.onDragOver(...o),["prevent"])),onDragleave:n[2]||(n[2]=(...o)=>e.onDragLeave&&e.onDragLeave(...o)),onDrop:n[3]||(n[3]=C((...o)=>e.onDrop&&e.onDrop(...o),["prevent"])),for:r.idComponent},[n[4]||(n[4]=s("i",{style:{padding:"2px 6px 0 6px"},class:"fa fa-paperclip","aria-hidden":"true"},null,-1)),B(" "+g(e.isDragOver?c.$t("i18nCommon.MsFileUpload.IsDragOver"):c.$t("i18nCommon.MsFileUpload.PlaceHolder")),1)],42,K)])],2)):D("",!0),s("div",W,[(p(!0),f(E,null,j(e.listFile,(o,u)=>(p(),f("div",{key:u},[s("div",G,[n[6]||(n[6]=s("div",{class:"mi mi-16 attackment-icon"},[s("i",{class:"fa fa-paperclip","aria-hidden":"true"})],-1)),s("div",{onClick:y=>e.downloadFile(o,u),class:"text-ellipsis pointer"},[s("span",{class:"file-name",title:o.FileName},g(o.name?o.name:o.FileName),9,R),s("span",null,g(" ("+e.formatSize(o.FileSize||o.size)+")"),1)],8,Q),r.disabled?D("",!0):(p(),f("div",{key:0,class:b([r.disabled?"disabled-event":"","close-button flex-center cursor-pointer"]),onClick:y=>e.deleteFile(o,u)},n[5]||(n[5]=[s("div",{class:"mi mi-16 close-button-icon"},[s("i",{class:"fa fa-times","aria-hidden":"true"})],-1)]),10,X))])]))),128))])],2)])}const ie=O(A,[["render",Y],["__scopeId","data-v-ddbb21a4"]]);export{ie as M};
