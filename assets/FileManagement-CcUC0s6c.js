import{d as P,g as T,r as y,B as j,_ as L,j as U,m as O,o as d,w as C,b as l,k as H,v as w,t as I,a as m,p as A,F as B,l as E}from"./index-DmUMvrSQ.js";import{f as u}from"./fileAPI-_RNgakGO.js";const R=P({props:{},setup(){const{proxy:n}=T(),s=y({}),p=y([]),f=y([]),V=t=>{var o;const e=n;setTimeout(()=>{e.$ms.commonFn.focusFirstControl(e.$refs["slot-content"])},100),e._popup=e.$vfm.dynamicModals[e.$vfm.dynamicModals.length-1],e._formParam=t.ref.params._rawValue?t.ref.params._rawValue:t.ref.params,(o=e._formParam)!=null&&o.editor&&(s.value=e._formParam.editor,v())},b=async(t,e,o)=>{await j(n.$t("i18nCommon.AskDeleteRecord"))&&($(t,o),o=="img"?p.value.splice(e,1):f.value.splice(e,1),u.deleteFile(t.replace(u.getUrlViewFile(),"")))},$=(t,e)=>{var _,g,M,F;if(!((g=(_=s.value)==null?void 0:_.$refs)!=null&&g.froala))return;const o=s.value.$refs.froala;let a=o==null?void 0:o.modelValue;const r=new DOMParser().parseFromString(a,"text/html");r.querySelectorAll(e).forEach(D=>{D.getAttribute("src")===t&&D.remove()});const c=r.body.innerHTML;typeof((F=(M=s.value)==null?void 0:M.editorInstance)==null?void 0:F.setEditorValue)=="function"&&s.value.editorInstance.setEditorValue(c)},k=(t,e)=>{var o,a,i,r,c;typeof((a=(o=s.value)==null?void 0:o.editorInstance)==null?void 0:a.execCommand)=="function"&&e=="image"?s.value.editorInstance.execCommand("insertImage",!0,t):typeof((c=(r=(i=s.value)==null?void 0:i.editorInstance)==null?void 0:r.selection)==null?void 0:c.insertHTML)=="function"&&s.value.editorInstance.selection.insertHTML(`
          <video src="${t}" 
            width="300" 
            height="300" 
            controls
            playsinline autoplay
          >
            Video không thể phát. Vui lòng kiểm tra lại!
          </video>
        `),h()},v=()=>{const t=n;s.value.pathMedia&&(t.$ms.commonFn.mask(),u.getAllFileInPath(s.value.pathMedia).then(e=>{var o;if((o=e==null?void 0:e.Data)!=null&&o.length){const a=[],i=[];e.Data.forEach(r=>{const c=r.split(".").pop().toLowerCase(),_=["png","jpg","jpeg","gif","webp","bmp"],g=["mp4","avi","mov","mkv","webm","flv"];_.includes(c)?a.push(u.getFileViewUrl(`${s.value.pathMedia}/${r}`)):g.includes(c)&&i.push(u.getFileViewUrl(`${s.value.pathMedia}/${r}`))}),a!=null&&a.length&&(p.value=a),i!=null&&i.length&&(f.value=i)}}).finally(()=>{t.$ms.commonFn.unmask()}))},h=()=>{try{const t=n;t._popup.value=!1,t.$nextTick(()=>{delete t._popup})}catch(t){console.error(t)}};return{listImageUrl:p,listVideoUrl:f,deleteRow:b,beforeOpen:V,handleInsertMedia:k}}}),S={ref:"slot-content",class:"form-content-popup"},x={class:"form-container pd-t-4"},N={class:"form-detail"},q={key:0,class:"lst-user"},G=["onDblclick"],z=["src"],J=["onClick","title"],K={key:1,class:"lst-user"},Q=["onDblclick"],W=["src"],X=["onClick","title"],Y={class:"form-action"},Z={class:"form-action_container"},ee={class:"form-action_item"};function te(n,s,p,f,V,b){const $=U("ms-button"),k=U("ms-dynamic-popup");return d(),O(k,{width:1e3,height:600,title:n.$t("i18nCommon.MsFileUpload.ImageManagement"),onBeforeOpen:n.beforeOpen},{content:C(({close:v})=>{var h,t;return[l("div",S,[l("div",x,[l("div",N,[(h=n.listImageUrl)!=null&&h.length?(d(),m("div",q,[(d(!0),m(B,null,E(n.listImageUrl,(e,o)=>(d(),m("div",{class:"user-item flex justify-between",key:e},[l("div",{class:"img",onDblclick:a=>n.handleInsertMedia(e,"image")},[l("img",{src:e,alt:""},null,8,z),w(" "+I(e),1)],40,G),l("div",{onClick:a=>n.deleteRow(e,o,"img"),title:n.$t("i18nCommon.delete"),class:"fa-solid fa-trash color-icon-primary"},null,8,J)]))),128))])):A("",!0),(t=n.listVideoUrl)!=null&&t.length?(d(),m("div",K,[(d(!0),m(B,null,E(n.listVideoUrl,(e,o)=>(d(),m("div",{class:"user-item flex justify-between",key:e},[l("div",{class:"img",onDblclick:a=>n.handleInsertMedia(e,"video")},[l("video",{src:e,alt:""},null,8,W),w(" "+I(e),1)],40,Q),l("div",{onClick:a=>n.deleteRow(e,o,"video"),title:n.$t("i18nCommon.delete"),class:"fa-solid fa-trash color-icon-primary"},null,8,X)]))),128))])):A("",!0)])])],512)]}),footer:C(({close:v})=>[l("div",Y,[l("div",Z,[s[0]||(s[0]=l("div",{class:"form-action_item"},null,-1)),l("div",ee,[H($,{onClick:v},{default:C(()=>[w(I(n.$t("i18nCommon.Close")),1)]),_:2},1032,["onClick"])])])])]),_:1},8,["title","onBeforeOpen"])}const se=L(R,[["render",te],["__scopeId","data-v-4a2a6f00"]]);export{se as default};
