import{m as U,p as N,s as L}from"./crudBaseStore-BQfEd0nr.js";import{v as R}from"./validateComponent-kMK-YP6C.js";import{co as C,cy as k,cz as V,cA as G,cB as q,cC as j,a3 as $,cD as H,cE as _,cF as d,cG as F,cH as m,cI as J,cm as K,cJ as W,a4 as Y,B as Q}from"./index-DmUMvrSQ.js";var w=Object.create,X=function(){function e(){}return function(t){if(!C(t))return{};if(w)return w(t);e.prototype=t;var a=new e;return e.prototype=void 0,a}}(),v=function(){try{var e=k(Object,"defineProperty");return e({},"",{}),e}catch{}}();function Z(e,t){for(var a=-1,r=e==null?0:e.length;++a<r&&t(e[a],a,e)!==!1;);return e}function z(e,t,a){t=="__proto__"&&v?v(e,t,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[t]=a}var ee=Object.prototype,te=ee.hasOwnProperty;function ae(e,t,a){var r=e[t];(!(te.call(e,t)&&V(r,a))||a===void 0&&!(t in e))&&z(e,t,a)}var oe=G(Object.getPrototypeOf,Object),x=typeof exports=="object"&&exports&&!exports.nodeType&&exports,S=x&&typeof module=="object"&&module&&!module.nodeType&&module,re=S&&S.exports===x,h=re?q.Buffer:void 0;h&&h.allocUnsafe;function ne(e,t){return e.slice()}var se=Object.prototype,ce=se.hasOwnProperty;function ie(e){var t=e.length,a=new e.constructor(t);return t&&typeof e[0]=="string"&&ce.call(e,"index")&&(a.index=e.index,a.input=e.input),a}function l(e){var t=new e.constructor(e.byteLength);return new j(t).set(new j(e)),t}function fe(e,t){var a=l(e.buffer);return new e.constructor(a,e.byteOffset,e.byteLength)}var ue=/\w*$/;function me(e){var t=new e.constructor(e.source,ue.exec(e));return t.lastIndex=e.lastIndex,t}var A=$?$.prototype:void 0,D=A?A.valueOf:void 0;function de(e){return D?Object(D.call(e)):{}}function le(e,t){var a=l(e.buffer);return new e.constructor(a,e.byteOffset,e.length)}var pe="[object Boolean]",be="[object Date]",ge="[object Map]",ye="[object Number]",Te="[object RegExp]",je="[object Set]",$e="[object String]",we="[object Symbol]",ve="[object ArrayBuffer]",Se="[object DataView]",he="[object Float32Array]",Ae="[object Float64Array]",De="[object Int8Array]",Me="[object Int16Array]",Oe="[object Int32Array]",Ce="[object Uint8Array]",_e="[object Uint8ClampedArray]",Fe="[object Uint16Array]",xe="[object Uint32Array]";function Ee(e,t,a){var r=e.constructor;switch(t){case ve:return l(e);case pe:case be:return new r(+e);case Se:return fe(e);case he:case Ae:case De:case Me:case Oe:case Ce:case _e:case Fe:case xe:return le(e);case ge:return new r;case ye:case $e:return new r(e);case Te:return me(e);case je:return new r;case we:return de(e)}}function Be(e){return typeof e.constructor=="function"&&!H(e)?X(oe(e)):{}}var Pe="[object Map]";function Ie(e){return _(e)&&d(e)==Pe}var M=m&&m.isMap,Ue=M?F(M):Ie,Ne="[object Set]";function Le(e){return _(e)&&d(e)==Ne}var O=m&&m.isSet,Re=O?F(O):Le,E="[object Arguments]",ke="[object Array]",Ve="[object Boolean]",Ge="[object Date]",qe="[object Error]",B="[object Function]",He="[object GeneratorFunction]",Je="[object Map]",Ke="[object Number]",P="[object Object]",We="[object RegExp]",Ye="[object Set]",Qe="[object String]",Xe="[object Symbol]",Ze="[object WeakMap]",ze="[object ArrayBuffer]",et="[object DataView]",tt="[object Float32Array]",at="[object Float64Array]",ot="[object Int8Array]",rt="[object Int16Array]",nt="[object Int32Array]",st="[object Uint8Array]",ct="[object Uint8ClampedArray]",it="[object Uint16Array]",ft="[object Uint32Array]",o={};o[E]=o[ke]=o[ze]=o[et]=o[Ve]=o[Ge]=o[tt]=o[at]=o[ot]=o[rt]=o[nt]=o[Je]=o[Ke]=o[P]=o[We]=o[Ye]=o[Qe]=o[Xe]=o[st]=o[ct]=o[it]=o[ft]=!0;o[qe]=o[B]=o[Ze]=!1;function u(e,t,a,r,p,c){var n;if(n!==void 0)return n;if(!C(e))return e;var b=Y(e);if(b)n=ie(e);else{var f=d(e),g=f==B||f==He;if(J(e))return ne(e);if(f==P||f==E||g&&!p)n=g?{}:Be(e);else{if(!o[f])return p?e:{};n=Ee(e,f)}}c||(c=new K);var y=c.get(e);if(y)return y;c.set(e,n),Re(e)?e.forEach(function(s){n.add(u(s,t,a,s,e,c))}):Ue(e)&&e.forEach(function(s,i){n.set(i,u(s,t,a,i,e,c))});var I=W,T=b?void 0:I(e);return Z(T||e,function(s,i){T&&(i=s,s=e[i]),ae(n,i,u(s,t,a,i,e,c))}),n}var ut=1,mt=4;function dt(e){return u(e,ut|mt)}const gt={mixins:[U,N,R,L],data(){return{viewRef:"viewList",storeModule:{},api:{},editMode:null,model:{},_formParam:{},hideAfterSave:!0}},created(){},mounted(){this.bindData()},beforeUnmount(){},methods:{async beforeBindData(){},async afterBindData(){},async bindData(){var t;const e=this;await e.beforeBindData(),((t=Object.keys(e._formParam.dataRow))==null?void 0:t.length)!==0&&(e.model=e._formParam.dataRow),e.editMode==e.$ms.constant.FormState.Add&&delete e.model[e.storeModule._config.field.key],await e.afterBindData(),setTimeout(()=>{e.$ms.commonFn.focusFirstControl(e.$refs["slot-content"])},100)},beforeOpen(e){const t=this;t._popup=t.$vfm.dynamicModals[t.$vfm.dynamicModals.length-1],t._formParam=e.ref.params._rawValue?e.ref.params._rawValue:e.ref.params,t.editMode=t._formParam.formState},hide(){try{const e=this;e._popup.value=!1,e.$nextTick(()=>{delete e._popup})}catch(e){console.error(e)}},async handleDuplicateDataDelete(){const e=this;if(await Q(e.$t("i18nCommon.AskRestoreDuplicateData"))){e.$ms.commonFn.mask();const a=await e.api.restoreDataDelete(e.model);e.$ms.commonFn.unmask(),a!=null&&a.Success&&(a!=null&&a.Data)&&(e.model[e.storeModule._config.field.key]=a.Data[e.storeModule._config.field.key],e.storeModule.insertItem(e.model),e.editMode=e.$ms.constant.FormState.Edit,e.$ms.commonFn.pushNotification({type:e.$ms.constant.ENotificationType.Success,message:e.$t("i18nCommon.crud.restore_success")}))}},async save(){const e=this,t=dt(e.model);if(await e.beforeSave(t),await e.validateSave(t)){let a=!1,r;switch(e.$ms.commonFn.mask(),e.editMode){case e.$ms.constant.FormState.Add:r=await e.storeModule.insert(t),r!=null&&r.Success?(e.$ms.commonFn.pushNotification({type:e.$ms.constant.ENotificationType.Success,message:e.$t("i18nCommon.crud.save_success")}),a=!0):r.Code==e.$ms.constant.EnumValidateResult.DuplicateDelete&&await e.handleDuplicateDataDelete();break;case e.$ms.constant.FormState.Edit:r=await e.storeModule.update(t),r!=null&&r.Success&&(e.$ms.commonFn.pushNotification({type:e.$ms.constant.ENotificationType.Success,message:e.$t("i18nCommon.crud.edit_success")}),a=!0);break}a&&(await e.afterSaveSuccess(r),e.hideAfterSave&&e.hide()),e.$ms.commonFn.unmask()}},async beforeSave(e){},async afterSaveSuccess(e){},async validateSaveCustom(e){return!0},async validateSave(e){const t=this;return await t.validateComponents()&&await t.validateSaveCustom(e)}}};export{gt as B};
