var I=Object.defineProperty;var A=(e,o,r)=>o in e?I(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r;var _=(e,o,r)=>A(e,typeof o!="symbol"?o+"":o,r);import{I as U,J as P,d as L,g as O,r as V,e as M,B as j,G as T,_ as q,j as u,m as E,o as y,w as m,b as i,k as a,v as g,t as d,a as D,p as J,F as z,l as G}from"./index-DmUMvrSQ.js";import{c as W}from"./crudBaseStore-BQfEd0nr.js";import{B as H}from"./BaseDetail-zykIlOpR.js";import{c as K}from"./configNotifyAPI-CtG8A22k.js";import{u as Q}from"./remoteCombobox-B8Q4up6i.js";import{p as X}from"./popupUtil-BIlfh91z.js";import"./validateComponent-kMK-YP6C.js";class Y extends U{constructor(){super(...arguments);_(this,"apiName","dictionary");_(this,"controllerName","ReceiveNotify")}}const B=new Y,S=new W({field:{key:"receive_notify_id",code:"receive_notify_code"}},B);class Z{constructor(){_(this,"state",()=>({...S.state}));_(this,"actions",{...S.actions})}}const x=new Z,ee=P("moduleReceiveNotify",x),oe=L({mixins:[],extends:H,setup(){const{proxy:e}=O(),o=ee(),r=V(B),R=V("config_recieve_notify"),{comboboxLoadData:$}=Q(),N=M({config_notify:[]}),c=t=>{const s=e;s.model.receiver_ids=t.map(l=>l.user_id).join(";"),p()},p=async()=>{var k,F;const t=e;if(!t.model.receiver_ids){t.model.ReceiverDetail=[];return}const s=["user_id","in",t.model.receiver_ids.split(";")],l={PageIndex:0,PageSize:0,Columns:"user_id,user_name,user_code,user_full_name,phone_number",Filter:JSON.stringify(s)};t.$ms.commonFn.mask();let v=await T.getList(l);t.$ms.commonFn.unmask(),(F=(k=v==null?void 0:v.Data)==null?void 0:k.PageData)!=null&&F.length&&(t.model.ReceiverDetail=v.Data.PageData)};return{api:r,storeModule:o,subSystemCode:R,dataCombobox:N,configNotifyAPI:K,comboboxLoadData:$,filterInactive:t=>{const s=e;if(s.editMode==s.$ms.constant.FormState.Add){const l=["is_active","=",!0];s.$ms.commonFn.concatFilter(t,l)}},selectedConfigNotify:t=>{const s=e;s.model.config_notify_code=t.newData?t.newData.config_notify_code:null,s.model.config_notify_name=t.newData?t.newData.config_notify_name:null},openSelectUser:()=>{const s={selectedUser:c,receiver_ids:e.model.receiver_ids};X.show("ReceiveSelectUser",s)},deleteAllRow:async()=>{const t=e;await j(t.$t("i18nCommon.AskDeleteRecord"))&&(t.model.receiver_ids="",t.model.ReceiverDetail=[])},afterBindData:async()=>{p()},deleteRow:t=>{const s=e;s.model.ReceiverDetail=s.model.ReceiverDetail.filter(l=>l.user_id!=t.user_id),s.model.receiver_ids=s.model.ReceiverDetail.map(l=>l.user_id).join(";")}}}}),te={ref:"slot-content",class:"form-content-popup"},ie={class:"form-container mt-4"},ne={class:"form-item_input"},se={class:"form-group"},le={class:"form-group"},ae={class:"form-item_input"},de={class:"form-group"},re={class:"form-group"},me={class:"form-item_input"},ce={class:"form-group"},fe={class:"form-item_input"},_e={class:"form-group"},ue={class:"select-title"},pe={key:0,class:"lst-user"},ve=["onClick","title"],ye={class:"flex lst-btn gap-8"},ge={class:"form-action"},be={class:"form-action_container"},Ce={class:"form-action_item"},De={class:"form-action_item"};function Re(e,o,r,R,$,N){const c=u("ms-input"),p=u("ms-combobox-v2"),w=u("ms-textarea"),f=u("ms-button"),h=u("ms-dynamic-popup");return y(),E(h,{width:800,height:700,title:`${e.editMode?e.$ms.commonFn.getEnumResource(e.editMode,"FormState"):""} ${e.$t("i18nReceiveNotify.Title")}`,onBeforeOpen:e.beforeOpen},{content:m(({close:b})=>{var C;return[i("div",te,[i("div",ie,[i("div",ne,[i("div",se,[a(c,{maxLength:50,rules:[{name:"required"}],label:e.$t("i18nReceiveNotify.Detail.receive_notify_code"),modelValue:e.model.receive_notify_code,"onUpdate:modelValue":o[0]||(o[0]=n=>e.model.receive_notify_code=n)},null,8,["label","modelValue"])]),i("div",le,[a(c,{maxLength:100,rules:[{name:"required"}],label:e.$t("i18nReceiveNotify.Detail.receive_notify_name"),modelValue:e.model.receive_notify_name,"onUpdate:modelValue":o[1]||(o[1]=n=>e.model.receive_notify_name=n)},null,8,["label","modelValue"])])]),i("div",ae,[i("div",de,[a(p,{label:e.$t("i18nReceiveNotify.Detail.config_notify_name"),valueField:"config_notify_id",displayField:"config_notify_name",data:e.dataCombobox.config_notify,initText:e.model.config_notify_name,onComboboxLoadData:o[2]||(o[2]=n=>e.comboboxLoadData(n,e.configNotifyAPI,e.dataCombobox,"config_notify")),onSelected:e.selectedConfigNotify,buildFilter:e.filterInactive,dropdownWidth:400,columns:[{title:e.$t("i18nConfigNotify.Detail.config_notify_code"),dataField:"config_notify_code",width:160,filterOperator:e.$ms.constant.FilterOperator.Contains},{title:e.$t("i18nConfigNotify.Detail.config_notify_name"),dataField:"config_notify_name",width:220,filterOperator:e.$ms.constant.FilterOperator.Contains}],queryMode:"remote",remoteFilter:!0,modelValue:e.model.config_notify_id,"onUpdate:modelValue":o[3]||(o[3]=n=>e.model.config_notify_id=n),display:e.model.config_notify_name,"onUpdate:display":o[4]||(o[4]=n=>e.model.config_notify_name=n)},null,8,["label","data","initText","onSelected","buildFilter","columns","modelValue","display"])]),i("div",re,[a(c,{disabled:!0,label:e.$t("i18nReceiveNotify.Detail.config_notify_code"),modelValue:e.model.config_notify_code,"onUpdate:modelValue":o[5]||(o[5]=n=>e.model.config_notify_code=n)},null,8,["label","modelValue"])])]),i("div",me,[i("div",ce,[a(w,{maxLength:250,label:e.$t("i18nReceiveNotify.Detail.description"),modelValue:e.model.description,"onUpdate:modelValue":o[6]||(o[6]=n=>e.model.description=n)},null,8,["label","modelValue"])])]),i("div",fe,[i("div",_e,[i("div",null,[i("label",ue,d(e.$t("i18nReceiveNotify.Detail.receiver_ids")),1),(C=e.model.ReceiverDetail)!=null&&C.length?(y(),D("div",pe,[(y(!0),D(z,null,G(e.model.ReceiverDetail,n=>(y(),D("div",{class:"user-item flex justify-between",key:n.user_id},[i("span",null,d(n.user_name)+" - "+d(n.user_full_name)+" - "+d(n.phone_number),1),i("div",{onClick:t=>e.deleteRow(n),title:e.$t("i18nCommon.delete"),class:"fa-solid fa-xmark color-icon-primary"},null,8,ve)]))),128))])):J("",!0),i("div",ye,[a(f,{onClick:e.openSelectUser},{default:m(()=>[g(d(e.$t("i18nReceiveNotify.Detail.selected_user")),1)]),_:1},8,["onClick"]),a(f,{onClick:e.deleteAllRow,disabled:!e.model.receiver_ids},{default:m(()=>[g(d(e.$t("i18nCommon.crud.delete_all_row")),1)]),_:1},8,["onClick","disabled"])])])])])])],512)]}),footer:m(({close:b})=>[i("div",ge,[i("div",be,[i("div",Ce,[a(f,{onClick:b},{default:m(()=>[g(d(e.$t("i18nCommon.Close")),1)]),_:2},1032,["onClick"])]),i("div",De,[a(f,{onClick:e.save,class:"primary"},{default:m(()=>[g(d(e.$t("i18nCommon.crud.save")),1)]),_:1},8,["onClick"])])])])]),_:1},8,["title","onBeforeOpen"])}const Be=q(oe,[["render",Re],["__scopeId","data-v-85e57db6"]]);export{Be as default};
